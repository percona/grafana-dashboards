{"version":3,"sources":["../../src/canvas/tooltip.js"],"names":["d3","$","moment","valueFormatter","TOOLTIP_PADDING_X","TOOLTIP_PADDING_Y","CarpetplotTooltip","elem","scope","tooltip","dashboard","ctrl","panel","carpetPanel","on","onMouseOver","bind","onMouseLeave","e","show","hasData","add","move","destroy","select","append","attr","remove","pos","bucket","isInChart","hasValue","tooltipTimeFormat","time","formatDate","decimals","data","format","unitFormat","formatter","value","tooltipHtml","html","node","pageX","pageY","tooltipWidth","clientWidth","tooltipHeight","clientHeight","left","top","window","innerWidth","pageYOffset","innerHeight","style"],"mappings":";;;;;;;;;;;;;;;AAAOA,Q;;AACAC,O;;AACAC,Y;;AAEEC,oB,eAAAA,c;;;;;;;;;;;;;;;;;;;;;AAELC,uB,GAAoB,E;AACpBC,uB,GAAoB,C;;AAElBC,uB;AAEJ,mCAAYC,IAAZ,EAAkBC,KAAlB,EAAyB;AAAA;;AACvB,eAAKC,OAAL,GAAe,IAAf;AACA,eAAKD,KAAL,GAAaA,KAAb;AACA,eAAKE,SAAL,GAAiBF,MAAMG,IAAN,CAAWD,SAA5B;AACA,eAAKE,KAAL,GAAaJ,MAAMG,IAAN,CAAWC,KAAxB;AACA,eAAKC,WAAL,GAAmBN,IAAnB;;AAEAA,eAAKO,EAAL,CAAQ,WAAR,EAAqB,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAArB;AACAT,eAAKO,EAAL,CAAQ,YAAR,EAAsB,KAAKG,YAAL,CAAkBD,IAAlB,CAAuB,IAAvB,CAAtB;AACD;;;;sCAEWE,C,EAAG;AACb,gBAAI,CAAC,KAAKN,KAAL,CAAWH,OAAX,CAAmBU,IAApB,IAA4B,CAAC,KAAKX,KAAL,CAAWY,OAAX,EAAjC,EAAuD;AAAE;AAAS;;AAElE,gBAAI,CAAC,KAAKX,OAAV,EAAmB;AACjB,mBAAKY,GAAL;AACA,mBAAKC,IAAL,CAAUJ,CAAV;AACD;AACF;;;yCAEc;AACb,iBAAKK,OAAL;AACD;;;sCAEWL,C,EAAG;AACb,gBAAI,CAAC,KAAKN,KAAL,CAAWH,OAAX,CAAmBU,IAAxB,EAA8B;AAAE;AAAS;;AAEzC,iBAAKG,IAAL,CAAUJ,CAAV;AACD;;;gCAEK;AACJ,iBAAKT,OAAL,GAAeT,GAAGwB,MAAH,CAAU,MAAV,EACZC,MADY,CACL,KADK,EAEZC,IAFY,CAEP,OAFO,EAEE,8CAFF,CAAf;AAGD;;;oCAES;AACR,gBAAI,KAAKjB,OAAT,EAAkB;AAChB,mBAAKA,OAAL,CAAakB,MAAb;AACD;;AAED,iBAAKlB,OAAL,GAAe,IAAf;AACD;;;+BAEImB,G,EAAKC,M,EAAQ;AAChB,gBAAI,CAAC,KAAKjB,KAAL,CAAWH,OAAX,CAAmBU,IAApB,IAA4B,CAAC,KAAKX,KAAL,CAAWsB,SAAX,CAAqBF,GAArB,CAA7B,IAA0D,CAACC,OAAOE,QAAP,EAA/D,EAAkF;AAChF,mBAAKR,OAAL;AACA;AACD;;AAED,gBAAI,CAAC,KAAKd,OAAV,EAAmB;AACjB,mBAAKY,GAAL;AACD;;AAED,gBAAMW,oBAAoB,yBAA1B;AACA,gBAAMC,OAAO,KAAKvB,SAAL,CAAewB,UAAf,CAA0BL,OAAOI,IAAjC,EAAuCD,iBAAvC,CAAb;AACA,gBAAMG,WAAW,KAAKvB,KAAL,CAAWwB,IAAX,CAAgBD,QAAjC;AACA,gBAAME,SAAS,KAAKzB,KAAL,CAAWwB,IAAX,CAAgBE,UAA/B;AACA,gBAAMC,YAAYpC,eAAekC,MAAf,EAAuBF,QAAvB,CAAlB;AACA,gBAAMK,QAAQD,UAAUV,OAAOW,KAAjB,CAAd;;AAEA,gBAAIC,6DACgCR,IADhC,6CAGUO,KAHV,kCAAJ;;AAOA,iBAAK/B,OAAL,CAAaiC,IAAb,CAAkBD,WAAlB;;AAEA,iBAAKnB,IAAL,CAAUM,GAAV;AACD;;;+BAEIA,G,EAAK;AACR,gBAAI,CAAC,KAAKnB,OAAV,EAAmB;AAAE;AAAS;;AAE9B,gBAAMF,OAAON,EAAE,KAAKQ,OAAL,CAAakC,IAAb,EAAF,EAAuB,CAAvB,CAAb;AAHQ,gBAIAC,KAJA,GAIiBhB,GAJjB,CAIAgB,KAJA;AAAA,gBAIOC,KAJP,GAIiBjB,GAJjB,CAIOiB,KAJP;;AAKR,gBAAMC,eAAevC,KAAKwC,WAA1B;AACA,gBAAMC,gBAAgBzC,KAAK0C,YAA3B;;AAEA,gBAAIC,OAAON,QAAQxC,iBAAnB;AACA,gBAAI+C,MAAMN,QAAQxC,iBAAlB;;AAEA,gBAAIuC,QAAQE,YAAR,GAAuB,EAAvB,GAA4BM,OAAOC,UAAvC,EAAmD;AACjDH,qBAAON,QAAQE,YAAR,GAAuB1C,iBAA9B;AACD;;AAED,gBAAIyC,QAAQO,OAAOE,WAAf,GAA6BN,aAA7B,GAA6C,EAA7C,GAAkDI,OAAOG,WAA7D,EAA0E;AACxEJ,oBAAMN,QAAQG,aAAR,GAAwB3C,iBAA9B;AACD;;AAED,mBAAO,KAAKI,OAAL,CACJ+C,KADI,CACE,MADF,EACUN,OAAO,IADjB,EAEJM,KAFI,CAEE,KAFF,EAESL,MAAM,IAFf,CAAP;AAGD;;;;;;yBAGY7C,iB","file":"tooltip.js","sourcesContent":["import d3 from 'd3';\r\nimport $ from 'jquery';\r\nimport moment from 'moment';\r\n\r\nimport { valueFormatter } from '../formatting';\r\n\r\nlet TOOLTIP_PADDING_X = 30;\r\nlet TOOLTIP_PADDING_Y = 5;\r\n\r\nclass CarpetplotTooltip {\r\n\r\n  constructor(elem, scope) {\r\n    this.tooltip = null;\r\n    this.scope = scope;\r\n    this.dashboard = scope.ctrl.dashboard;\r\n    this.panel = scope.ctrl.panel;\r\n    this.carpetPanel = elem;\r\n\r\n    elem.on('mouseover', this.onMouseOver.bind(this));\r\n    elem.on('mouseleave', this.onMouseLeave.bind(this));\r\n  }\r\n\r\n  onMouseOver(e) {\r\n    if (!this.panel.tooltip.show || !this.scope.hasData()) { return; }\r\n\r\n    if (!this.tooltip) {\r\n      this.add();\r\n      this.move(e);\r\n    }\r\n  }\r\n\r\n  onMouseLeave() {\r\n    this.destroy();\r\n  }\r\n\r\n  onMouseMove(e) {\r\n    if (!this.panel.tooltip.show) { return; }\r\n\r\n    this.move(e);\r\n  }\r\n\r\n  add() {\r\n    this.tooltip = d3.select('body')\r\n      .append('div')\r\n      .attr('class', 'carpet-tooltip graph-tooltip grafana-tooltip');\r\n  }\r\n\r\n  destroy() {\r\n    if (this.tooltip) {\r\n      this.tooltip.remove();\r\n    }\r\n\r\n    this.tooltip = null;\r\n  }\r\n\r\n  show(pos, bucket) {\r\n    if (!this.panel.tooltip.show || !this.scope.isInChart(pos) || !bucket.hasValue()) {\r\n      this.destroy();\r\n      return;\r\n    }\r\n\r\n    if (!this.tooltip) {\r\n      this.add();\r\n    }\r\n\r\n    const tooltipTimeFormat = 'ddd YYYY-MM-DD HH:mm:ss';\r\n    const time = this.dashboard.formatDate(bucket.time, tooltipTimeFormat);\r\n    const decimals = this.panel.data.decimals;\r\n    const format = this.panel.data.unitFormat;\r\n    const formatter = valueFormatter(format, decimals);\r\n    const value = formatter(bucket.value);\r\n\r\n    let tooltipHtml = `\r\n      <div class='graph-tooltip-time'>${time}</div>\r\n      <div>\r\n      value: <b>${value}</b><br/>\r\n      </div>\r\n    `;\r\n\r\n    this.tooltip.html(tooltipHtml);\r\n\r\n    this.move(pos);\r\n  }\r\n\r\n  move(pos) {\r\n    if (!this.tooltip) { return; }\r\n\r\n    const elem = $(this.tooltip.node())[0];\r\n    const { pageX, pageY } = pos;\r\n    const tooltipWidth = elem.clientWidth;\r\n    const tooltipHeight = elem.clientHeight;\r\n\r\n    let left = pageX + TOOLTIP_PADDING_X;\r\n    let top = pageY + TOOLTIP_PADDING_Y;\r\n\r\n    if (pageX + tooltipWidth + 40 > window.innerWidth) {\r\n      left = pageX - tooltipWidth - TOOLTIP_PADDING_X;\r\n    }\r\n\r\n    if (pageY - window.pageYOffset + tooltipHeight + 20 > window.innerHeight) {\r\n      top = pageY - tooltipHeight - TOOLTIP_PADDING_Y;\r\n    }\r\n\r\n    return this.tooltip\r\n      .style('left', left + 'px')\r\n      .style('top', top + 'px');\r\n  }\r\n}\r\n\r\nexport default CarpetplotTooltip;"]}