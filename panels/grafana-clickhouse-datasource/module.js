/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","emotion","lodash","@grafana/runtime"],(function(e,t,n,r,a,o){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=106)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){var r=n(25),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();e.exports=o},function(e,t){e.exports=o},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r=n(24),a=n(46),o=n(47),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?a(e):o(e)}},function(e,t,n){var r=n(55),a=n(56),o=n(57),i=n(58),l=n(59);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=a,u.prototype.get=o,u.prototype.has=i,u.prototype.set=l,e.exports=u},function(e,t,n){var r=n(12);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(15)(Object,"create");e.exports=r},function(e,t,n){var r=n(74);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t,n){var r=n(44),a=n(51);e.exports=function(e,t){var n=a(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(9),a=n(5);e.exports=function(e){if(!a(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){var r=n(23);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(16),a=n(33);e.exports=function(e){return null!=e&&a(e.length)&&!r(e)}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(22),a=n(40),o=n(41);e.exports=function(e,t){return o(a(e,t,r),e+"")}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(15),a=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=a},function(e,t,n){var r=n(6).Symbol;e.exports=r},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(45))},function(e,t,n){var r=n(54),a=n(28),o=n(78),i=n(80),l=n(5),u=n(37),c=n(36);e.exports=function e(t,n,s,f,d){t!==n&&o(n,(function(o,u){if(d||(d=new r),l(o))i(t,n,u,s,e,f,d);else{var p=f?f(c(t,u),o,u+"",t,n,d):void 0;void 0===p&&(p=o),a(t,u,p)}}),u)}},function(e,t,n){var r=n(15)(n(6),"Map");e.exports=r},function(e,t,n){var r=n(17),a=n(12);e.exports=function(e,t,n){(void 0!==n&&!a(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},function(e,t,n){var r=n(88)(Object.getPrototypeOf,Object);e.exports=r},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(89),a=n(8),o=Object.prototype,i=o.hasOwnProperty,l=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return a(e)&&i.call(e,"callee")&&!l.call(e,"callee")};e.exports=u},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){(function(e){var r=n(6),a=n(91),o=t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,l=i&&i.exports===o?r.Buffer:void 0,u=(l?l.isBuffer:void 0)||a;e.exports=u}).call(this,n(18)(e))},function(e,t,n){var r=n(93),a=n(94),o=n(95),i=o&&o.isTypedArray,l=i?a(i):r;e.exports=l},function(e,t){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},function(e,t,n){var r=n(99),a=n(101),o=n(19);e.exports=function(e){return o(e)?r(e,!0):a(e)}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var r=n(20),a=n(21),o=n(53),i=n(103),l=a((function(e){return e.push(void 0,o),r(i,void 0,e)}));e.exports=l},function(e,t,n){var r=n(20),a=Math.max;e.exports=function(e,t,n){return t=a(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,l=a(o.length-t,0),u=Array(l);++i<l;)u[i]=o[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=o[i];return c[t]=n(u),r(e,this,c)}}},function(e,t,n){var r=n(42),a=n(52)(r);e.exports=a},function(e,t,n){var r=n(43),a=n(23),o=n(22),i=a?function(e,t){return a(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=i},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var r=n(16),a=n(48),o=n(5),i=n(50),l=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,s=u.toString,f=c.hasOwnProperty,d=RegExp("^"+s.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||a(e))&&(r(e)?d:l).test(i(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(24),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,l=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,l),n=e[l];try{e[l]=void 0;var r=!0}catch(e){}var a=i.call(e);return r&&(t?e[l]=n:delete e[l]),a}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,a=n(49),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(6)["__core-js_shared__"];e.exports=r},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t){var n=Date.now;e.exports=function(e){var t=0,r=0;return function(){var a=n(),o=16-(a-r);if(r=a,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var r=n(26),a=n(5);e.exports=function e(t,n,o,i,l,u){return a(t)&&a(n)&&(u.set(n,t),r(t,n,void 0,e,u),u.delete(n)),t}},function(e,t,n){var r=n(10),a=n(60),o=n(61),i=n(62),l=n(63),u=n(64);function c(e){var t=this.__data__=new r(e);this.size=t.size}c.prototype.clear=a,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=l,c.prototype.set=u,e.exports=c},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(11),a=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():a.call(t,n,1),--this.size,!0)}},function(e,t,n){var r=n(11);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(11);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(11);e.exports=function(e,t){var n=this.__data__,a=r(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this}},function(e,t,n){var r=n(10);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(10),a=n(27),o=n(65);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var i=n.__data__;if(!a||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(i)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(66),a=n(73),o=n(75),i=n(76),l=n(77);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=a,u.prototype.get=o,u.prototype.has=i,u.prototype.set=l,e.exports=u},function(e,t,n){var r=n(67),a=n(10),o=n(27);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||a),string:new r}}},function(e,t,n){var r=n(68),a=n(69),o=n(70),i=n(71),l=n(72);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=a,u.prototype.get=o,u.prototype.has=i,u.prototype.set=l,e.exports=u},function(e,t,n){var r=n(13);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(13),a=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return a.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(13),a=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:a.call(t,e)}},function(e,t,n){var r=n(13);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(14);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(14);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(14);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(14);e.exports=function(e,t){var n=r(this,e),a=n.size;return n.set(e,t),this.size+=n.size==a?0:1,this}},function(e,t,n){var r=n(79)();e.exports=r},function(e,t){e.exports=function(e){return function(t,n,r){for(var a=-1,o=Object(t),i=r(t),l=i.length;l--;){var u=i[e?l:++a];if(!1===n(o[u],u,o))break}return t}}},function(e,t,n){var r=n(28),a=n(81),o=n(82),i=n(85),l=n(86),u=n(31),c=n(32),s=n(90),f=n(34),d=n(16),p=n(5),m=n(92),v=n(35),h=n(36),b=n(96);e.exports=function(e,t,n,g,y,E,C){var T=h(e,n),S=h(t,n),O=C.get(S);if(O)r(e,n,O);else{var L=E?E(T,S,n+"",e,t,C):void 0,A=void 0===L;if(A){var w=c(S),x=!w&&f(S),N=!w&&!x&&v(S);L=S,w||x||N?c(T)?L=T:s(T)?L=i(T):x?(A=!1,L=a(S,!0)):N?(A=!1,L=o(S,!0)):L=[]:m(S)||u(S)?(L=T,u(T)?L=b(T):p(T)&&!d(T)||(L=l(S))):A=!1}A&&(C.set(S,L),y(L,S,g,E,C),C.delete(S)),r(e,n,L)}}},function(e,t,n){(function(e){var r=n(6),a=t&&!t.nodeType&&t,o=a&&"object"==typeof e&&e&&!e.nodeType&&e,i=o&&o.exports===a?r.Buffer:void 0,l=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=l?l(n):new e.constructor(n);return e.copy(r),r}}).call(this,n(18)(e))},function(e,t,n){var r=n(83);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},function(e,t,n){var r=n(84);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t,n){var r=n(6).Uint8Array;e.exports=r},function(e,t){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},function(e,t,n){var r=n(87),a=n(29),o=n(30);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(a(e))}},function(e,t,n){var r=n(5),a=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(a)return a(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var r=n(9),a=n(8);e.exports=function(e){return a(e)&&"[object Arguments]"==r(e)}},function(e,t,n){var r=n(19),a=n(8);e.exports=function(e){return a(e)&&r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(9),a=n(29),o=n(8),i=Function.prototype,l=Object.prototype,u=i.toString,c=l.hasOwnProperty,s=u.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=r(e))return!1;var t=a(e);if(null===t)return!0;var n=c.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==s}},function(e,t,n){var r=n(9),a=n(33),o=n(8),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&a(e.length)&&!!i[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(25),a=t&&!t.nodeType&&t,o=a&&"object"==typeof e&&e&&!e.nodeType&&e,i=o&&o.exports===a&&r.process,l=function(){try{var e=o&&o.require&&o.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=l}).call(this,n(18)(e))},function(e,t,n){var r=n(97),a=n(37);e.exports=function(e){return r(e,a(e))}},function(e,t,n){var r=n(98),a=n(17);e.exports=function(e,t,n,o){var i=!n;n||(n={});for(var l=-1,u=t.length;++l<u;){var c=t[l],s=o?o(n[c],e[c],c,n,e):void 0;void 0===s&&(s=e[c]),i?a(n,c,s):r(n,c,s)}return n}},function(e,t,n){var r=n(17),a=n(12),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var i=e[t];o.call(e,t)&&a(i,n)&&(void 0!==n||t in e)||r(e,t,n)}},function(e,t,n){var r=n(100),a=n(31),o=n(32),i=n(34),l=n(38),u=n(35),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),s=!n&&a(e),f=!n&&!s&&i(e),d=!n&&!s&&!f&&u(e),p=n||s||f||d,m=p?r(e.length,String):[],v=m.length;for(var h in e)!t&&!c.call(e,h)||p&&("length"==h||f&&("offset"==h||"parent"==h)||d&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||l(h,v))||m.push(h);return m}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(5),a=n(30),o=n(102),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=a(e),n=[];for(var l in e)("constructor"!=l||!t&&i.call(e,l))&&n.push(l);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){var r=n(26),a=n(104)((function(e,t,n,a){r(e,t,n,a)}));e.exports=a},function(e,t,n){var r=n(21),a=n(105);e.exports=function(e){return r((function(t,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,l=o>2?n[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,l&&a(n[0],n[1],l)&&(i=o<3?void 0:i,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,i)}return t}))}},function(e,t,n){var r=n(12),a=n(19),o=n(38),i=n(5);e.exports=function(e,t,n){if(!i(n))return!1;var l=typeof t;return!!("number"==l?a(n)&&o(t,n.length):"string"==l&&t in n)&&r(n[t],e)}},function(e,t,n){"use strict";n.r(t);var r=n(2),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function l(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}u((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}Object.create;function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function f(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.create;var d,p,m,v,h,b,g=n(7);!function(e){e[e.TABLE=1]="TABLE",e[e.TIMESERIES=2]="TIMESERIES"}(d||(d={})),function(e){e.SQL="sql",e.Builder="builder"}(p||(p={})),function(e){e.List="list",e.Aggregate="aggregate",e.Trend="trend"}(m||(m={})),function(e){e.Sum="sum",e.Average="avg",e.Min="min",e.Max="max",e.Count="count"}(v||(v={})),function(e){e.ASC="ASC",e.DESC="DESC"}(h||(h={})),function(e){e.IsNull="IS NULL",e.IsNotNull="IS NOT NULL",e.Equals="=",e.NotEquals="!=",e.LessThan="<",e.LessThanOrEqual="<=",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.Like="LIKE",e.NotLike="NOT LIKE",e.In="IN",e.NotIn="NOT IN",e.WithInGrafanaTimeRange="WITH IN DASHBOARD TIME RANGE",e.OutsideGrafanaTimeRange="OUTSIDE DASHBOARD TIME RANGE"}(b||(b={}));p.Builder;var y={queryType:p.Builder,rawSql:"",builderOptions:{mode:m.List,fields:[],limit:100},format:d.TABLE},E=(p.SQL,d.TABLE,n(4));function C(e){var t,n,r=((t=new Map).set("",[]),t.set("WITH",[]),t.set("SELECT",[]),t.set("DISTINCT",[]),t.set("FROM",[]),t.set("SAMPLE",[]),t.set("JOIN",[]),t.set("PREWHERE",[]),t.set("WHERE",[]),t.set("GROUP BY",[]),t.set("LIMIT BY",[]),t.set("HAVING",[]),t.set("LIMIT",[]),t.set("OFFSET",[]),t.set("UNION",[]),t.set("INTERSECT",[]),t.set("EXCEPT",[]),t.set("INTO OUTFILE",[]),t.set("FORMAT",[]),t),a=/\b(WITH|SELECT|DISTINCT|FROM|SAMPLE|JOIN|PREWHERE|WHERE|GROUP BY|LIMIT BY|HAVING|LIMIT|OFFSET|UNION|INTERSECT|EXCEPT|INTO OUTFILE|FORMAT)\b/gi,o={count:0,lastCount:0,phrase:""},i="";for(r.set("",[e.split(a,2)[0]]);null!==(n=a.exec(e));){var l=n[0].toUpperCase(),u=e.substring(a.lastIndex,e.length).split(a,2)[0];o.count>0?o.phrase+=l+u:(r.set(l,[u]),i=l,o.phrase=u),o.count+=(u.match(/\(/g)||[]).length,o.count-=(u.match(/\)/g)||[]).length,o.count<=0&&o.lastCount>0&&(o.phrase.match(/\bSELECT\b/gi)?r.set(i,T(o.phrase)):r.set(i,[o.phrase])),o.lastCount=o.count}return r}function T(e){for(var t,n=[],r=/\b(AND|OR|,)\b/gi,a={count:0,lastCount:0,phrase:""},o=-1,i=0;null!==(t=r.exec(e));){var l=t[0].toUpperCase(),u=e.substring(i,t.index);i=r.lastIndex,a.count>0?a.phrase+=u+l:(n.push(u+l),o++,a.phrase=u+l),a.count+=(u.match(/\(/g)||[]).length,a.count-=(u.match(/\)/g)||[]).length,a.count<=0&&a.lastCount>0&&S(n,a.phrase,o),a.lastCount=a.count}var c=e.substring(i,e.length);return a.count>0?a.phrase+=c:(a.phrase=c,o++),S(n,a.phrase,o),n}function S(e,t,n){t.match(/\bSELECT\b/gi)?e[n]=C(t):e[n]=t}var O,L=function(){function e(){this._targetTable=""}return e.prototype.setTargetTable=function(e){var t=C(e);this.setTargetTableFroAST(t)},e.prototype.setTargetTableFroAST=function(e){if(e.get("FROM")){var t=e.get("FROM")[0];Object(E.isString)(t)?this._targetTable=t.trim().replace(/(\(|\)|,)/gi,""):this.setTargetTableFroAST(t)}},e.prototype.apply=function(e,t){if(""===this._targetTable||""===e||!t||0===t.length)return e;for(var n="",r=0;r<t.length;r++){var a=t[r],o=isNaN(Number(a.value))?"'"+a.value+"'":Number(a.value);n+=" "+a.key+" "+a.operator+" "+o+" ",r!==t.length-1&&(n+=a.condition?a.condition:"AND")}var i=C(e=e.replace(";",""));return function e(t,n,r){var a,o;if(!t||!t.get("FROM"))return t;if(!r)return t;try{for(var i=u(t.get("FROM")),l=i.next();!l.done;l=i.next()){var c=l.value;if(Object(E.isString)(c)){var s=RegExp("\\b"+r+"\\b","g");if(!c.match(s))continue;var f=t.get("WHERE");if(0===(null==f?void 0:f.length)){var d=t.get("FROM"),p=d[d.length-1].toString().trim().substring(r.length);t.set("WHERE",[n+" "+p]);var m=t.get("FROM").indexOf(c);t.get("FROM")[m]=" "+r+" ";continue}f.unshift(n+" AND ")}}}catch(e){a={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(a)throw a.error}}return t.forEach((function(t){var a,o;try{for(var i=u(t),l=i.next();!l.done;l=i.next()){var c=l.value;null===c||Object(E.isString)(c)||e(c,n,r)}}catch(e){a={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(a)throw a.error}}})),t}(i,n,this._targetTable),function e(t){var n="";return t.forEach((function(t,r){var a,o,i=r+" ";try{for(var l=u(t),c=l.next();!c.done;c=l.next()){var s=c.value;Object(E.isString)(s)?i+=s.trim()+" ":null!==s&&(i+=e(s)+" ")}}catch(e){a={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(a)throw a.error}}i!==r+" "&&(n+=i)})),n.trim().replace(/\s+/g," ")}(i)},e}(),A=function(e){function t(t){var n=e.call(this,t)||this;return n.annotations={},n.skipAdHocFilter=!1,n.settings=t,n.templateSrv=Object(g.getTemplateSrv)(),n.adHocFilter=new L,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.metricFindQuery=function(e){var t,n,a,u,c;return i(this,void 0,void 0,(function(){var i,s,f;return l(this,(function(l){switch(l.label){case 0:return(i=Object(E.isString)(e)?{rawSql:e,queryType:p.SQL}:e).queryType!==p.SQL&&i.queryType!==p.Builder&&i.queryType?[2,[]]:i.rawSql?[4,this.runQuery(o(o({},i),{queryType:i.queryType||p.SQL}))]:[2,[]];case 1:return s=l.sent(),0===(null===(t=s.fields)||void 0===t?void 0:t.length)?[2,[]]:1===(null===(n=null==s?void 0:s.fields)||void 0===n?void 0:n.length)?[2,Object(r.vectorator)(null===(a=null==s?void 0:s.fields[0])||void 0===a?void 0:a.values).map((function(e){return{text:e,value:e}}))]:(f=null===(u=null==s?void 0:s.fields[0])||void 0===u?void 0:u.values,[2,Object(r.vectorator)(null===(c=null==s?void 0:s.fields[1])||void 0===c?void 0:c.values).map((function(e,t){return{text:e,value:f.get(t)}}))])}}))}))},t.prototype.applyTemplateVariables=function(e,t){var n,r=e.rawSql||"";return this.skipAdHocFilter||(r=this.adHocFilter.apply(r,null===(n=this.templateSrv)||void 0===n?void 0:n.getAdhocFilters(this.name))),this.skipAdHocFilter=!1,o(o({},e),{rawSql:this.replace(r,t)||""})},t.prototype.replace=function(e,t){return void 0!==e?Object(g.getTemplateSrv)().replace(e,t,this.format):e},t.prototype.format=function(e){return Array.isArray(e)?"'"+e.join("','")+"'":e},t.prototype.getDefaultDatabase=function(){return this.settings.jsonData.defaultDatabase},t.prototype.fetchDatabases=function(){return i(this,void 0,Promise,(function(){return l(this,(function(e){return[2,this.fetchData("SHOW DATABASES")]}))}))},t.prototype.fetchTables=function(e){return i(this,void 0,Promise,(function(){var t;return l(this,(function(n){return t=e?"SHOW TABLES FROM "+e:"SHOW TABLES",[2,this.fetchData(t)]}))}))},t.prototype.fetchEntities=function(){return i(this,void 0,void 0,(function(){return l(this,(function(e){return[2,this.fetchTables()]}))}))},t.prototype.fetchFields=function(e,t){return i(this,void 0,Promise,(function(){return l(this,(function(n){return[2,this.fetchData("DESC TABLE "+e+"."+t)]}))}))},t.prototype.fetchFieldsFull=function(e,t){var n;return i(this,void 0,Promise,(function(){var a,o;return l(this,(function(i){switch(i.label){case 0:return a="DESC TABLE "+e+(""===e?"":".")+t,[4,this.runQuery({rawSql:a})];case 1:return o=i.sent(),0===(null===(n=o.fields)||void 0===n?void 0:n.length)?[2,[]]:[2,new r.DataFrameView(o).map((function(e){return{name:e[0],type:e[1],label:e[0],picklistValues:[]}}))]}}))}))},t.prototype.fetchData=function(e){return i(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return[4,this.runQuery({rawSql:e})];case 1:return t=n.sent(),[2,this.values(t)]}}))}))},t.prototype.runQuery=function(e){var t=this;return new Promise((function(n){var r={targets:[o(o({},e),{refId:String(Math.random())})]};t.query(r).subscribe((function(e){n(e.data[0]||{fields:[]})}))}))},t.prototype.values=function(e){var t,n;return 0===(null===(t=e.fields)||void 0===t?void 0:t.length)?[]:Object(r.vectorator)(null===(n=null==e?void 0:e.fields[0])||void 0===n?void 0:n.values).map((function(e){return e}))},t.prototype.getTagKeys=function(){return i(this,void 0,Promise,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this.fetchTags()];case 1:return[2,e.sent().fields.map((function(e){return{text:e.name}}))]}}))}))},t.prototype.getTagValues=function(e){var t=e.key;return i(this,void 0,Promise,(function(){var e,n;return l(this,(function(a){switch(a.label){case 0:return[4,this.fetchTags()];case 1:return e=a.sent(),(n=e.fields.find((function(e){return e.name===t})))?[2,Object(r.vectorator)(n.values).filter((function(e){return null!==e})).map((function(e){return{text:String(e)}}))]:[2,[]]}}))}))},t.prototype.fetchTags=function(){return i(this,void 0,Promise,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return"$clickhouse_adhoc_query"!==(e=this.templateSrv.replace("$clickhouse_adhoc_query"))?[3,1]:[2,new r.ArrayDataFrame([])];case 1:return this.skipAdHocFilter=!0,this.adHocFilter.setTargetTable(e),[4,this.runQuery({rawSql:e})];case 2:return[2,t.sent()]}}))}))},t}(g.DataSourceWithBackend),w=n(0),x=n.n(w),N=n(1),I=function(e){var t=e.hasCert,n=e.label,r=e.onChange,a=e.onClick,o=e.placeholder;return x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:12},n),t?x.a.createElement(x.a.Fragment,null,x.a.createElement(N.Input,{css:{},type:"text",disabled:!0,value:"configured",width:24}),x.a.createElement(N.Button,{variant:"secondary",onClick:a,style:{marginLeft:4}},"Reset")):x.a.createElement(N.TextArea,{css:{},rows:7,onChange:r,placeholder:o,required:!0}))},_={ConfigEditor:{ServerAddress:{label:"Server address",placeholder:"Server address",tooltip:"ClickHouse server address"},ServerPort:{label:"Server port",placeholder:function(e){return"Typically "+("true"===e?"9440":"9000")},tooltip:"ClickHouse native TCP port. Typically 9000 for unsecure, 9440 for secure"},Username:{label:"Username",placeholder:"Username",tooltip:"ClickHouse username"},Password:{label:"Password",placeholder:"Password",tooltip:"ClickHouse password"},TLSSkipVerify:{label:"Skip TLS Verify",tooltip:"Skip TLS Verify"},TLSClientAuth:{label:"TLS Client Auth",tooltip:"TLS Client Auth"},TLSAuthWithCACert:{label:"With CA Cert",tooltip:"Needed for verifying self-signed TLS Certs"},TLSCACert:{label:"CA Cert",placeholder:"CA Cert. Begins with -----BEGIN CERTIFICATE-----"},TLSClientCert:{label:"Client Cert",placeholder:"Client Cert. Begins with -----BEGIN CERTIFICATE-----"},TLSClientKey:{label:"Client Key",placeholder:"Client Key. Begins with -----BEGIN RSA PRIVATE KEY-----"},DefaultDatabase:{label:"Default database",placeholder:"Default database",tooltip:"Default database to be used. Can be empty."},Secure:{label:"Secure Connection",tooltip:"Toggle on if the connection is secure"}},QueryEditor:{CodeEditor:{input:function(){return".monaco-editor textarea"},container:"data-testid-code-editor-container",Run:"data-testid-code-editor-run-button"},Types:{label:"Query Type",tooltip:"Query Type",options:{SQLEditor:"SQL Editor",QueryBuilder:"Query Builder"},switcher:{title:"Are you sure?",body:"You will lose manual changes done to the SQL if you go back to the query builder.",confirmText:"Continue",dismissText:"Cancel"}},QueryBuilder:{TYPES:{label:"Show as",tooltip:"Show as",options:{LIST:"Table",AGGREGATE:"Aggregate",TREND:"Time Series"}},DATABASE:{label:"Database",tooltip:"Clickhouse database to query from"},FROM:{label:"Table",tooltip:"Clickhouse table to query from"},SELECT:{label:"Fields",tooltipTable:"List of fields to show",tooltipAggregate:"List of metrics to show. Use any of the given aggregation along with the field",ALIAS:{label:"as",tooltip:"alias"},AddLabel:"Field",RemoveLabel:""},AGGREGATES:{label:"Aggregates",tooltipTable:"Aggregate functions to use",tooltipAggregate:"Aggregate functions to use",ALIAS:{label:"as",tooltip:"alias"},AddLabel:"Aggregate",RemoveLabel:""},WHERE:{label:"Filters",tooltip:"List of filters",AddLabel:"Filter",RemoveLabel:""},GROUP_BY:{label:"Group by",tooltip:"Group the results by specific field"},ORDER_BY:{label:"Order by",tooltip:"Order by field",AddLabel:"Order by",RemoveLabel:""},LIMIT:{label:"Limit",tooltip:"Number of records/results to show."},TIME_FIELD:{label:"Time field",tooltip:"Select the time field for trending over time"},PREVIEW:{label:"SQL Preview",tooltip:"SQL Preview. You can safely switch to SQL Editor to customize the generated query"}}}},j=_;!function(e){e[e.FIELD=3]="FIELD",e[e.DATABASE=8]="DATABASE",e[e.TABLE=5]="TABLE",e[e.VARIABLE=4]="VARIABLE"}(O||(O={}));var B,F,D,q,R,k,M,P,Q,G,W,Y=n(3),H={Common:{check:Object(Y.css)(B||(B=f(["\n      margin-top: 5px;\n    "],["\n      margin-top: 5px;\n    "]))),wrapper:Object(Y.css)(F||(F=f(["\n      position: relative;\n      width: 100%;\n    "],["\n      position: relative;\n      width: 100%;\n    "]))),smallBtn:Object(Y.css)(D||(D=f(["\n      margin-top: 5px;\n      margin-inline: 5px;\n    "],["\n      margin-top: 5px;\n      margin-inline: 5px;\n    "]))),selectWrapper:Object(Y.css)(q||(q=f(["\n      width: 100%;\n    "],["\n      width: 100%;\n    "]))),inlineSelect:Object(Y.css)(R||(R=f(["\n      margin-right: 5px;\n    "],["\n      margin-right: 5px;\n    "]))),firstLabel:Object(Y.css)(k||(k=f(["\n      margin-right: 5px;\n    "],["\n      margin-right: 5px;\n    "]))),run:Object(Y.css)(M||(M=f(["\n      position: absolute;\n      top: -1px;\n      left: 6px;\n      z-index: 100;\n      color: green;\n    "],["\n      position: absolute;\n      top: -1px;\n      left: 6px;\n      z-index: 100;\n      color: green;\n    "])))},ConfigEditor:{container:Object(Y.css)(P||(P=f(["\n      justify-content: space-between;\n      h5 {\n        line-height: 34px;\n        margin-bottom: 5px;\n      }\n      button {\n        margin-right: 5px;\n      }\n    "],["\n      justify-content: space-between;\n      h5 {\n        line-height: 34px;\n        margin-bottom: 5px;\n      }\n      button {\n        margin-right: 5px;\n      }\n    "]))),wide:Object(Y.css)(Q||(Q=f(["\n      width: 75%;\n    "],["\n      width: 75%;\n    "]))),subHeader:Object(Y.css)(G||(G=f(["\n      padding: 5px 0 5px 0;\n    "],["\n      padding: 5px 0 5px 0;\n    "])))},QueryEditor:{queryType:Object(Y.css)(W||(W=f(["\n      justify-content: space-between;\n      span {\n        display: flex;\n      }\n    "],["\n      justify-content: space-between;\n      span {\n        display: flex;\n      }\n    "])))},VariablesEditor:{}};function U(e,t,n){return i(this,void 0,Promise,(function(){var r,a,o,i,c,s,f,d,p,m,v,h,b,g,y,E;return l(this,(function(l){if(e.endsWith("$"))return[2,J(n)];r=["select","from","where"],a=e.replace(/[\n\r]/g," ");try{for(o=u(r),i=o.next();!i.done;i=o.next())c=i.value,a=a.replace(c,c.toUpperCase())}catch(e){y={error:e}}finally{try{i&&!i.done&&(E=o.return)&&E.call(o)}finally{if(y)throw y.error}}return a.endsWith("SELECT ")||a.endsWith("FROM ")||a.endsWith(", ")?void 0!==t.defaultDatabase?[2,V(t,n)]:[2,z(t,n)]:a.endsWith("WHERE ")?(d=a.split("FROM "),s=d[d.length-1],m=s.split(" WHERE"),f=m[0],[2,f.split(",").map((function(e){return e.trim()})).map((function(e){return{label:e,kind:O.TABLE,documentation:"Table",insertText:e,range:n}}))]):e.endsWith(".")?(d=e.split(" "),p=d[d.length-1],m=p.split("."),void 0!==t.defaultDatabase?(v=m[0],[2,$(t,n,"",v)]):2===m.length?(h=m[0],[2,V(t,n,h)]):(b=m[0],g=m[1],[2,$(t,n,b,g)])):[2,[]]}))}))}function z(e,t){return i(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,e.databases()];case 1:return[2,n.sent().map((function(e){return{label:e,kind:O.DATABASE,documentation:"Database",insertText:e,range:t}}))]}}))}))}function V(e,t,n){return i(this,void 0,void 0,(function(){return l(this,(function(r){switch(r.label){case 0:return[4,e.tables(n)];case 1:return[2,r.sent().map((function(e){return{label:e,kind:O.TABLE,documentation:"Table",insertText:e,range:t}}))]}}))}))}function $(e,t,n,r){return i(this,void 0,void 0,(function(){return l(this,(function(a){switch(a.label){case 0:return[4,e.fields(n,r)];case 1:return[2,a.sent().map((function(e){return{label:e,kind:O.FIELD,documentation:"Field",insertText:e,range:t}}))]}}))}))}function J(e){var t=Object(g.getTemplateSrv)();return t?t.getVariables().map((function(n){var r="${"+n.name+"}",a=t.replace(r);return{label:r,detail:"(Template Variable) "+a,kind:O.VARIABLE,documentation:"(Template Variable) "+a,insertText:"{"+n.name+"}",range:e}})):[]}var K=function(e){var t=C(e).get("SELECT");if(Object(E.isString)(t)){var n=t.replace(/\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\)/,"").split(",");if(n.length>1)return n[0].toLowerCase().endsWith("as time")?d.TIMESERIES:d.TABLE}return d.TABLE},X=function(e){var t=e.query,n=e.onRunQuery,r=e.onChange,a=e.datasource,u=function(e){var a=K(e);r(o(o({},t),{rawSql:e,format:a,queryType:p.SQL})),n()},c={databases:function(){return a.fetchDatabases()},tables:function(e){return a.fetchTables(e)},fields:function(e,t){return a.fetchFields(e,t)},defaultDatabase:a.getDefaultDatabase()},s=function(e,t){return i(void 0,void 0,void 0,(function(){var n;return l(this,(function(r){switch(r.label){case 0:return[4,U(e,c,t)];case 1:return n=r.sent(),[2,Promise.resolve({suggestions:n})]}}))}))};return x.a.createElement("div",{className:H.Common.wrapper},x.a.createElement("a",{onClick:function(){return u(t.rawSql||"")},className:H.Common.run,"data-testid":j.QueryEditor.CodeEditor.Run},x.a.createElement("i",{className:"fa fa-play"})),x.a.createElement(N.CodeEditor,{"aria-label":"SQL",height:"150px",language:"sql",value:t.rawSql||"",onSave:u,showMiniMap:!1,showLineNumbers:!0,onBlur:function(e){return r(o(o({},t),{rawSql:e}))},onEditorDidMount:function(e){return function(e,t,n){return i(this,void 0,void 0,(function(){var r=this;return l(this,(function(a){return t.updateOptions({fixedOverflowWidgets:!0}),void 0!==monaco.languages.getLanguages().find((function(t){return t.id===e}))||(monaco.languages.register({id:e}),monaco.languages.registerCompletionItemProvider("sql",{triggerCharacters:[" ","$",".",","],provideCompletionItems:function(e,t){return i(r,void 0,void 0,(function(){var r,a,o;return l(this,(function(i){return r=e.getWordUntilPosition(t),a=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),o={startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn},[2,n(a,o)]}))}))}})),[2]}))}))}("chSql",e,s)}}))},Z=function(e){return["boolean"].includes(e.toLowerCase())},ee=function(e){return void 0!==["int","float","decimal"].find((function(t){return e.toLowerCase().includes(t)}))},te=function(e){return["date","datetime"].includes(e.toLowerCase())},ne=function(e){return!(Z(e)||ee(e)||te(e))},re=function(e){return[b.IsNull,b.IsNotNull].includes(e.operator)},ae=function(e){return Z(e.type)},oe=function(e){return ee(e.type)},ie=function(e){return te(e.type)&&[b.WithInGrafanaTimeRange,b.OutsideGrafanaTimeRange].includes(e.operator)},le=function(e){return te(e.type)},ue=function(e){return ne(e.type)&&![b.In,b.NotIn].includes(e.operator)},ce=function(e){return ne(e.type)&&[b.In,b.NotIn].includes(e.operator)},se=function(e){return e.reduce((function(e,t,n){var r=0===n?"":t.condition,a="",o=t.key,i="",l=!1;if(t.operator===b.NotLike?(i="LIKE",l=!0):t.operator===b.OutsideGrafanaTimeRange?(i="",l=!0):i=[b.WithInGrafanaTimeRange].includes(t.operator)?"":t.operator,a=o+" "+i,re(t));else if(ae(t))a+=" "+t.value;else if(oe(t))a+=" "+(t.value||"0");else if(le(t))if(ie(t))"datetime"===t.type?a+=" >= ${__from:date} AND "+t.key+" <= ${__to:date}":"date"===t.type&&(a+=" >= ${__from:date:YYYY-MM-DD} AND "+t.key+" <= ${__to:date:YYYY-MM-DD}");else switch(t.value){case"GRAFANA_START_TIME":"datetime"===t.type?a+=" ${__from:date}":"date"===t.type&&(a+=" ${__from:date:YYYY-MM-DD}");break;case"GRAFANA_END_TIME":"datetime"===t.type?a+=" ${__to:date}":"date"===t.type&&(a+=" ${__to:date:YYYY-MM-DD}");break;default:a+=" "+(t.value||"TODAY")}else if(ue(t))t.operator===b.Like||t.operator===b.NotLike?a+=" '%"+(t.value||"")+"%'":a+=" '"+(t.value||"")+"'";else if(ce(t)){a+=" ("+t.value.map((function(e){return"'"+e.trim()+"'"})).join(", ")+" )"}return l&&(a=" NOT ( "+a+" )"),a?e+" "+r+" ( "+a+" )":e}),"")},fe=function(e){return void 0===e&&(e=[]),e.length>0?" GROUP BY "+e.map((function(e){return e})).join(", "):""},de=function(e){var t,n=e.limit?function(e){return" LIMIT "+(e||100)}(e.limit):"",r="";switch(e.mode){case m.Aggregate:r+=function(e,t,n,r,a){void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===a&&(a=[]),r=r&&r.length>0?r:[];var o=n.length>0?n.join(", ")+",":"",i=r.map((function(e){var t=e.alias?" "+e.alias.replace(/ /g,"_"):"";return e.aggregation+"("+e.field+")"+t})).join(", ");return a&&a.length>0&&(i=a.map((function(e){return""+e})).join(", ")+", "+i),"SELECT "+o+i+" FROM "+e+(""===e||""===t?"":".")+t}(e.database,e.table,e.fields,e.metrics,e.groupBy);var a=se(e.filters||[]);a&&(r+=" WHERE "+a),r+=fe(e.groupBy);break;case m.Trend:r+=function(e,t,n,r,a,o){void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===a&&(a=""),void 0===o&&(o="");var i,l=(r=r&&r.length>0?r:[]).map((function(e){var t=e.alias?" "+e.alias.replace(/ /g,"_"):"";return e.aggregation+"("+e.field+")"+t})).join(", ");""!==l?l=a+", "+(i=n.length>0?n.join(", ")+",":"")+l:l=""+a+(""!==(i=n.length>0?""+n.join(", "):"")?",":"")+i;return"SELECT "+l+" FROM "+e+(""===e||""===t?"":".")+t}(e.database,e.table,e.fields,e.metrics,e.timeField,e.timeFieldType),"datetime"===e.timeFieldType?r+=" WHERE "+e.timeField+" >= ${__from:date} AND "+e.timeField+" <= ${__to:date}":"date"===e.timeFieldType&&(r+=" WHERE "+e.timeField+" >= ${__from:date:YYYY-MM-DD} AND "+e.timeField+" <= ${__to:date:YYYY-MM-DD}");var o=se(e.filters||[]);r+=o?" AND "+o:"",r+=fe(e.groupBy);break;case m.List:default:r+=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]);var r=""===e||""===t?"":".";return"SELECT "+(n=n&&n.length>0?n:[""]).join(", ")+" FROM "+e+r+t}(e.database,e.table,e.fields);var i=se(e.filters||[]);i&&(r+=" WHERE "+i)}return e.mode===m.Trend?(r+=" ORDER BY "+e.timeField+" ASC",r+=n):(r+=(t=e.orderBy)&&t.filter((function(e){return e.name})).length>0?" ORDER BY "+t.filter((function(e){return e.name})).map((function(e){return e.name+" "+e.dir})).join(", "):"",r+=n),r};new Map([["equals",b.Equals],["contains",b.Like]]);var pe=n(39),me=n.n(pe),ve=function(e){var t=e.datasource,n=e.onTableChange,r=e.database,a=e.table,o=c(Object(w.useState)([]),2),u=o[0],s=o[1],f=j.QueryEditor.QueryBuilder.FROM,d=f.label,p=f.tooltip;Object(w.useEffect)((function(){!function(){i(this,void 0,void 0,(function(){var e,n;return l(this,(function(a){switch(a.label){case 0:return[4,t.fetchTables(r)];case 1:return e=a.sent(),(n=e.map((function(e){return{label:e,value:e}}))).push({label:"-- Choose --",value:""}),s(n),[2]}}))}))}()}),[t,r]);return x.a.createElement(x.a.Fragment,null,x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:p},d),x.a.createElement(N.Select,{className:"width-15 "+H.Common.inlineSelect,onChange:function(e){return t=e.value,void n(t);var t},options:u,value:a,menuPlacement:"auto"}))},he=function(e){var t=j.QueryEditor.QueryBuilder.TYPES,n=t.options,r=t.label,a=t.tooltip,o=[{value:m.List,label:n.LIST},{value:m.Aggregate,label:n.AGGREGATE},{value:m.Trend,label:n.TREND}];return x.a.createElement(x.a.Fragment,null,x.a.createElement(N.InlineFormLabel,{width:6,className:"query-keyword",tooltip:a},r),x.a.createElement(N.RadioButtonGroup,{options:o,value:e.mode,onChange:function(t){return e.onModeChange(t)}}))},be=function(e){var t=(e.fieldsList||[]).map((function(e){return{label:e.label,value:e.name}})),n=c(Object(w.useState)([]),2),r=n[0],a=n[1],o=c(Object(w.useState)(!1),2),i=o[0],l=o[1],u=[],f=c(Object(w.useState)(e.fields||[]),2),d=f[0],p=f[1],m=j.QueryEditor.QueryBuilder.SELECT,v=m.label,h=m.tooltipTable;Object(w.useEffect)((function(){if(0!==e.fieldsList.length){var t=ge(e.fields,e.fieldsList);a(t)}}),[e.fieldsList,e.fields]);var b=function(e){return u.map((function(e){return e.value})).includes(e[0])||u.map((function(e){return e.value})).includes(e[e.length-1])?[e[e.length-1]]:e};return x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:h},v),x.a.createElement("div",{"data-testid":"query-builder-fields-multi-select-container",className:H.Common.selectWrapper},x.a.createElement(N.MultiSelect,{options:s(t,u,r),value:d&&d.length>0?d:[],isOpen:i,onOpenMenu:function(){return l(!0)},onCloseMenu:function(){return l(!1)},onChange:function(t){l(!1),function(t){var n=b(t);p(n);var r=ge(t,e.fieldsList);a(r)}(t.map((function(e){return e.value})))},onBlur:function(){e.onFieldsChange(d)},allowCustomValue:!0})))};function ge(e,t){return e.filter((function(e){return-1===t.findIndex((function(t){return t.name===e}))})).map((function(e){return{label:e,value:e}}))}var ye=function(e){var t=(e.fieldsList||[]).map((function(e){return{label:e.label,value:e.name}})),n=c(Object(w.useState)(!1),2),r=n[0],a=n[1],i=e.metric,l=e.index,u=e.metrics,f=e.onMetricsChange,d=c(Object(w.useState)(i.alias||""),2),p=d[0],m=d[1],h=j.QueryEditor.QueryBuilder.AGGREGATES.ALIAS,b=[{value:v.Count,label:"Count"},{value:v.Sum,label:"Sum"},{value:v.Min,label:"Min"},{value:v.Max,label:"Max"},{value:v.Average,label:"Average"}];return x.a.createElement(x.a.Fragment,null,x.a.createElement(N.Select,{width:20,className:H.Common.inlineSelect,options:b,onChange:function(e){return t=e.value,n=s(u).map((function(e,n){return o(o({},e),{aggregation:n===l?t:e.aggregation})})),void f(n);var t,n},value:i.aggregation}),x.a.createElement(N.Select,{width:28,className:H.Common.inlineSelect,options:t,isOpen:r,onOpenMenu:function(){return a(!0)},onCloseMenu:function(){return a(!1)},onChange:function(e){a(!1);var t=s(u).map((function(t,n){return o(o({},t),{field:n===l?e.value:t.field})}));f(t)},value:i.field}),x.a.createElement(N.InlineFormLabel,{width:2,className:"query-keyword"},h.label),x.a.createElement(N.Input,{css:null,width:20,value:p,onChange:function(e){return m(e.currentTarget.value)},onBlur:function(){var e=s(u).map((function(e,t){return o(o({},e),{alias:t===l?p:e.alias})}));f(e)},placeholder:"alias"}))},Ee=function(e){var t=e.metrics,n=e.onMetricsChange,r=e.fieldsList,a=void 0===r?[]:r,o=j.QueryEditor.QueryBuilder.AGGREGATES,i=o.label,l=o.tooltipAggregate,u=o.AddLabel,c=o.RemoveLabel;return x.a.createElement(x.a.Fragment,null,t.map((function(e,r){return x.a.createElement("div",{className:"gf-form",key:r},0===r?x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:l},i):x.a.createElement("div",{className:"width-8 "+H.Common.firstLabel}),x.a.createElement(ye,{fieldsList:a,index:r,metric:e,metrics:t,onMetricsChange:n}),t.length>1&&x.a.createElement(N.Button,{icon:"trash-alt",size:"sm",variant:"destructive",className:H.Common.smallBtn,onClick:function(){return function(e){var r=s(t);r.splice(e,1),n(r)}(r)}},c))})),x.a.createElement("div",{className:"gf-form"},x.a.createElement("div",{className:"width-8 "+H.Common.firstLabel}),x.a.createElement(N.Button,{icon:"plus-circle",size:"sm",variant:"secondary",className:H.Common.smallBtn,onClick:function(){var e={field:"",aggregation:v.Count};n(s(t,[e]))}},u)))},Ce=function(e){var t=j.QueryEditor.QueryBuilder.TIME_FIELD,n=t.label,r=t.tooltip,a=(e.fieldsList||[]).filter((function(e){return"datetime"===e.type.toLowerCase()||"date"===e.type.toLowerCase()})).map((function(e){return{label:e.label,value:e.name}}));return x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:r},n),x.a.createElement(N.Select,{options:a,width:20,onChange:function(t){return e.onTimeFieldChange(t.value,(n=t.value,(r=e.fieldsList.find((function(e){return e.name===n})))?r.type:""));var n,r},value:e.timeField}))},Te=[{value:!0,label:"True"},{value:!1,label:"False"}],Se=[{value:"AND",label:"AND"},{value:"OR",label:"OR"}],Oe=[{value:b.Equals,label:"="},{value:b.NotEquals,label:"!="},{value:b.LessThan,label:"<"},{value:b.LessThanOrEqual,label:"<="},{value:b.GreaterThan,label:">"},{value:b.GreaterThanOrEqual,label:">="},{value:b.Like,label:"LIKE"},{value:b.NotLike,label:"NOT LIKE"},{value:b.In,label:"IN"},{value:b.NotIn,label:"NOT IN"},{value:b.IsNull,label:"IS NULL"},{value:b.IsNotNull,label:"IS NOT NULL"},{value:b.WithInGrafanaTimeRange,label:"WITHIN DASHBOARD TIME RANGE"},{value:b.OutsideGrafanaTimeRange,label:"OUTSIDE DASHBOARD TIME RANGE"}],Le=[{value:"today()",label:"TODAY"},{value:"yesterday()",label:"YESTERDAY"},{value:"now()",label:"NOW"},{value:"GRAFANA_START_TIME",label:"DASHBOARD START TIME"},{value:"GRAFANA_END_TIME",label:"DASHBOARD END TIME"}],Ae={filterType:"custom",condition:"AND",key:"Id",type:"id",operator:b.IsNotNull},we=function(e){var t=c(Object(w.useState)(e.value||0),2),n=t[0],r=t[1];return x.a.createElement("div",{"data-testid":"query-builder-filters-number-value-container"},x.a.createElement(N.Input,{css:null,"data-testid":"query-builder-filters-number-value-input",type:"number",value:n,onChange:function(e){return r(e.currentTarget.valueAsNumber||0)},onBlur:function(){return e.onChange(n)}}))},xe=function(e){var t=c(Object(w.useState)(e.value||""),2),n=t[0],r=t[1];return x.a.createElement("div",{"data-testid":"query-builder-filters-single-string-value-container"},x.a.createElement(N.Input,{css:null,type:"text",value:n,onChange:function(e){return r(e.currentTarget.value)},onBlur:function(){return e.onChange(n)}}))},Ne=function(e){var t=c(Object(w.useState)(e.value||[]),2),n=t[0],r=t[1];return x.a.createElement("div",{"data-testid":"query-builder-filters-multi-string-value-container"},x.a.createElement(N.Input,{css:null,type:"text",value:n.join(","),placeholder:"comma separated values",onChange:function(e){return r((e.currentTarget.value||"").split(","))},onBlur:function(){return e.onChange(n)}}))},Ie=function(e){var t=e.filter,n=e.onFilterChange,r=e.fieldsList,a=function(){var e=r.find((function(e){return e.name===t.key}));return(null==e?void 0:e.picklistValues)||[]};if(re(t))return x.a.createElement(x.a.Fragment,null);if(ae(t)){return x.a.createElement("div",{"data-testid":"query-builder-filters-boolean-value-container"},x.a.createElement(N.RadioButtonGroup,{options:Te,value:t.value,onChange:function(e){return r=e,void n(o(o({},t),{value:r}));var r}}))}if(oe(t))return x.a.createElement(we,{value:t.value,onChange:function(e){return n(o(o({},t),{value:e}))}});if(le(t)){return ie(t)?null:x.a.createElement("div",{"data-testid":"query-builder-filters-date-value-container"},x.a.createElement(N.Select,{value:t.value||"TODAY",onChange:function(e){return r=e.value,void n(o(o({},t),{value:r}));var r},options:s(Le)}))}if(ue(t)){var i=function(e){n(o(o({},t),{value:e}))};return"picklist"!==t.type||t.operator!==b.Equals&&t.operator!==b.NotEquals?x.a.createElement(xe,{value:t.value,onChange:i}):x.a.createElement("div",{"data-testid":"query-builder-filters-single-picklist-value-container"},x.a.createElement(N.Select,{value:t.value,onChange:function(e){return i(e.value)},options:a()}))}if(ce(t)){var l=function(e){n(o(o({},t),{value:e}))};return"picklist"===t.type?x.a.createElement("div",{"data-testid":"query-builder-filters-multi-picklist-value-container"},x.a.createElement(N.MultiSelect,{value:t.value,options:a(),onChange:function(e){return l(e.map((function(e){return e.value})))}})):x.a.createElement(Ne,{value:t.value,onChange:l})}return x.a.createElement(x.a.Fragment,null)},_e=function(e){var t,n=e.index,r=e.filter,a=e.fieldsList,o=e.onFilterChange,i=c(Object(w.useState)(!1),2),l=i[0],u=i[1];return x.a.createElement(x.a.Fragment,null,0!==n&&x.a.createElement(N.RadioButtonGroup,{options:Se,value:r.condition,onChange:function(e){return t=e,(a=r).condition=t,void o(n,a);var t,a}}),x.a.createElement(N.Select,{value:r.key,width:40,className:H.Common.inlineSelect,options:a.map((function(e){return{label:e.label,value:e.name}})),isOpen:l,onOpenMenu:function(){return u(!0)},onCloseMenu:function(){return u(!1)},onChange:function(e){return function(e){u(!1);var t=a.find((function(t){return t.name===e}));if(t){var i;if(Z(t.type))i={filterType:"custom",key:t.name,type:"boolean",condition:r.condition||"AND",operator:b.Equals,value:!1};else if(te(t.type)){i={filterType:"custom",key:t.name,type:t.type,condition:r.condition||"AND",operator:b.Equals,value:"TODAY"}}else{i={filterType:"custom",key:t.name,type:t.type,condition:r.condition||"AND",operator:b.IsNotNull}}o(n,i)}}(e.value)}}),x.a.createElement(N.Select,{value:r.operator,width:34,className:H.Common.inlineSelect,options:(t=r.type,void 0===t&&(t="string"),Z(t)?Oe.filter((function(e){return[b.Equals,b.NotEquals].includes(e.value)})):ee(t)?Oe.filter((function(e){return[b.IsNull,b.IsNotNull,b.Equals,b.NotEquals,b.LessThan,b.LessThanOrEqual,b.GreaterThan,b.GreaterThanOrEqual].includes(e.value)})):te(t)?Oe.filter((function(e){return[b.IsNull,b.IsNotNull,b.Equals,b.NotEquals,b.LessThan,b.LessThanOrEqual,b.GreaterThan,b.GreaterThanOrEqual,b.WithInGrafanaTimeRange,b.OutsideGrafanaTimeRange].includes(e.value)})):Oe.filter((function(e){return[b.IsNull,b.IsNotNull,b.Equals,b.NotEquals,b.Like,b.NotLike,b.In,b.NotIn].includes(e.value)}))),onChange:function(e){return t=e.value,(a=r).operator=t,ce(a)&&(Array.isArray(a.value)||(a.value=[a.value||""])),void o(n,a);var t,a}}),x.a.createElement(Ie,{filter:r,onFilterChange:function(e){o(n,e)},fieldsList:a}))},je=function(e){var t=e.filters,n=void 0===t?[]:t,r=e.onFiltersChange,a=e.fieldsList,i=void 0===a?[]:a,l=j.QueryEditor.QueryBuilder.WHERE,u=l.label,c=l.tooltip,f=l.AddLabel,d=l.RemoveLabel,p=function(){r(s(n,[o({},Ae)]))},m=function(e,t){var a=s(n);a[e]=t,r(a)};return x.a.createElement(x.a.Fragment,null,0===n.length&&x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:c},u),x.a.createElement(N.Button,{"data-testid":"query-builder-filters-add-button",icon:"plus-circle",variant:"secondary",size:"sm",className:H.Common.smallBtn,onClick:p},f)),n.map((function(e,t){return x.a.createElement("div",{className:"gf-form",key:t},0===t?x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:c},u):x.a.createElement("div",{className:"width-8 "+H.Common.firstLabel}),x.a.createElement(_e,{fieldsList:i,filter:e,onFilterChange:m,index:t}),x.a.createElement(N.Button,{"data-testid":"query-builder-filters-remove-button",icon:"trash-alt",variant:"destructive",size:"sm",className:H.Common.smallBtn,onClick:function(){return function(e){var t=s(n);t.splice(e,1),r(t)}(t)}},d))})),0!==n.length&&x.a.createElement("div",{className:"gf-form"},x.a.createElement("div",{className:"width-8 "+H.Common.firstLabel}),x.a.createElement(N.Button,{"data-testid":"query-builder-filters-inline-add-button",icon:"plus-circle",variant:"secondary",size:"sm",className:H.Common.smallBtn,onClick:p},f)))},Be=function(e){var t=(e.fieldsList||[]).map((function(e){return{label:e.label,value:e.name}})),n=c(Object(w.useState)(!1),2),r=n[0],a=n[1],o=c(Object(w.useState)(e.groupBy||[]),2),i=o[0],l=o[1],u=j.QueryEditor.QueryBuilder.GROUP_BY,s=u.label,f=u.tooltip;return x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:f},s),x.a.createElement("div",{"data-testid":"query-builder-group-by-multi-select-container",className:H.Common.selectWrapper},x.a.createElement(N.MultiSelect,{options:t,placeholder:"(Optional) Click here to choose",isOpen:r,onOpenMenu:function(){return a(!0)},onCloseMenu:function(){return a(!1)},onChange:function(e){a(!1),l(e.map((function(e){return e.value})))},onBlur:function(){return e.onGroupByChange(i)},value:i})))},Fe=function(e){var t=e.fieldsList||[],n=e.index,r=e.orderByItem,a=[{value:h.ASC,label:"ASC"},{value:h.DESC,label:"DESC"}];return x.a.createElement(x.a.Fragment,null,x.a.createElement(N.Select,{value:r.name,className:H.Common.inlineSelect,width:20,options:t,onChange:function(t){return r=t.value,a=s(e.orderBy).map((function(e,t){return o(o({},e),{name:t===n?r:e.name})})),void e.onOrderByItemsChange(a);var r,a}}),x.a.createElement(N.Select,{value:r.dir,className:H.Common.inlineSelect,width:12,options:a,onChange:function(t){return r=t.value,a=s(e.orderBy).map((function(e,t){return o(o({},e),{dir:t===n?r:e.dir})})),void e.onOrderByItemsChange(a);var r,a}}))},De=function(e){var t=e.fieldsList||[],n=j.QueryEditor.QueryBuilder.ORDER_BY,r=n.label,a=n.tooltip,o=n.AddLabel,i=n.RemoveLabel,l=function(){var n,r=s(e.orderBy);r.push({name:(null===(n=t[0])||void 0===n?void 0:n.value)||"Name",dir:h.ASC}),e.onOrderByItemsChange(r)};return 0===t.length?null:x.a.createElement(x.a.Fragment,null,0===e.orderBy.length?x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:a},r),x.a.createElement(N.Button,{"data-testid":"query-builder-orderby-add-button",icon:"plus-circle",variant:"secondary",size:"sm",onClick:l,className:H.Common.smallBtn},o)):x.a.createElement(x.a.Fragment,null,e.orderBy.map((function(t,n){return x.a.createElement("div",{className:"gf-form",key:n,"data-testid":"query-builder-orderby-item-wrapper"},0===n?x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword","data-testid":"query-builder-orderby-item-label",tooltip:a},r):x.a.createElement("div",{className:"width-8 "+H.Common.firstLabel}),x.a.createElement(Fe,{index:n,orderBy:e.orderBy,orderByItem:t,onOrderByItemsChange:e.onOrderByItemsChange,fieldsList:e.fieldsList}),x.a.createElement(N.Button,{"data-testid":"query-builder-orderby-remove-button",className:H.Common.smallBtn,variant:"destructive",size:"sm",icon:"trash-alt",onClick:function(){return function(t){var n=s(e.orderBy);n.splice(t,1),e.onOrderByItemsChange(n)}(n)}},i))})),x.a.createElement("div",{className:"gf-form"},x.a.createElement("div",{className:"width-8 "+H.Common.firstLabel}),x.a.createElement(N.Button,{"data-testid":"query-builder-orderby-inline-add-button",icon:"plus-circle",variant:"secondary",size:"sm",onClick:l,className:H.Common.smallBtn},o))))},qe=function(e,t){switch(e.mode){case m.Aggregate:return s((e.fields||[]).map((function(e){return{value:e,label:e}})),(e.metrics||[]).map((function(e){return{value:e.aggregation+"("+e.field+")",label:e.aggregation+"("+e.field+")"}})),(e.groupBy||[]).map((function(e){return{value:e,label:e}})));case m.List:default:return t.map((function(e){return{value:e.name,label:e.label}}))}},Re=function(e){var t=c(Object(w.useState)(e.limit||10),2),n=t[0],r=t[1],a=j.QueryEditor.QueryBuilder.LIMIT,o=a.label,i=a.tooltip;return x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:i},o),x.a.createElement(N.Input,{css:null,width:10,value:n,type:"number",min:1,onChange:function(e){return r(e.currentTarget.valueAsNumber)},onBlur:function(){return e.onLimitChange(n)}}))},ke=function(e){var t=e.datasource,n=e.onChange,r=c(Object(w.useState)([]),2),a=r[0],o=r[1],u=j.QueryEditor.QueryBuilder.DATABASE,s=u.label,f=u.tooltip;return Object(w.useEffect)((function(){!function(){i(this,void 0,void 0,(function(){var e,n;return l(this,(function(r){switch(r.label){case 0:return[4,t.fetchDatabases()];case 1:return e=r.sent(),n=e.map((function(e){return{label:e,value:e}})),o(n),[2]}}))}))}()}),[t]),x.a.createElement(x.a.Fragment,null,x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:f},s),x.a.createElement(N.Select,{className:"width-15 "+H.Common.inlineSelect,onChange:function(e){return n(e.value)},options:a,value:e.value,menuPlacement:"auto"}))},Me=function(e){var t=c(Object(w.useState)([]),2),n=t[0],r=t[1],a=me()(e.builderOptions,y.builderOptions);Object(w.useEffect)((function(){var t,n;a.table&&(t=a.database,n=a.table,i(void 0,void 0,void 0,(function(){return l(this,(function(a){return e.datasource.fetchFieldsFull(t,n).then((function(e){return i(void 0,void 0,void 0,(function(){return l(this,(function(t){return e.push({name:"*",label:"ALL",type:"string",picklistValues:[]}),r(e),[2]}))}))})).catch((function(e){throw e})),[2]}))})))}),[e.datasource,a.table]);var u,s=(u=[],n.forEach((function(e){u.push(e)})),u);return a?x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{className:"gf-form"},x.a.createElement(ke,{datasource:e.datasource,value:a.database,onChange:function(t){void 0===t&&(t=""),r([]);var n=o(o({},a),{database:t,table:"",fields:[],filters:[],orderBy:[]});e.onBuilderOptionsChange(n)}}),x.a.createElement(he,{mode:a.mode,onModeChange:function(t){if(t===m.List){var n=o(o({},a),{mode:t,fields:a.fields||[],orderBy:[]});e.onBuilderOptionsChange(n)}else if(t===m.Aggregate){n=o(o({},a),{mode:t,orderBy:[],metrics:a.metrics||[]});e.onBuilderOptionsChange(n)}else if(t===m.Trend){n=o(o({},a),{mode:m.Trend,timeField:a.timeField||"",timeFieldType:a.timeFieldType||"datetime",metrics:a.metrics||[]});e.onBuilderOptionsChange(n)}}})),x.a.createElement("div",{className:"gf-form"},x.a.createElement(ve,{datasource:e.datasource,database:a.database,table:a.table,onTableChange:function(t){void 0===t&&(t="");var n=o(o({},a),{table:t,fields:[],filters:[],orderBy:[]});e.onBuilderOptionsChange(n)}})),a.mode===m.Trend&&x.a.createElement(Ce,{timeField:a.timeField,timeFieldType:a.timeFieldType,onTimeFieldChange:function(t,n){void 0===t&&(t=""),void 0===n&&(n="");var r=o(o({},a),{timeField:t,timeFieldType:n});e.onBuilderOptionsChange(r)},fieldsList:s}),x.a.createElement(be,{fields:a.fields||[],onFieldsChange:function(t){void 0===t&&(t=[]);var n=o(o({},a),{fields:t});e.onBuilderOptionsChange(n)},fieldsList:s}),(a.mode===m.Aggregate||a.mode===m.Trend)&&x.a.createElement(Ee,{metrics:a.metrics||[],onMetricsChange:function(t){void 0===t&&(t=[]);var n=o(o({},a),{metrics:t});e.onBuilderOptionsChange(n)},fieldsList:s}),x.a.createElement(je,{filters:a.filters||[],onFiltersChange:function(t){void 0===t&&(t=[]);var n=o(o({},a),{filters:t});e.onBuilderOptionsChange(n)},fieldsList:s}),(a.mode===m.Aggregate||a.mode===m.Trend)&&x.a.createElement(Be,{groupBy:a.groupBy||[],onGroupByChange:function(t){void 0===t&&(t=[]);var n=o(o({},a),{groupBy:t});e.onBuilderOptionsChange(n)},fieldsList:s}),x.a.createElement(x.a.Fragment,null,x.a.createElement(De,{orderBy:a.orderBy||[],onOrderByItemsChange:function(t){void 0===t&&(t=[]);var n=o(o({},a),{orderBy:t});e.onBuilderOptionsChange(n)},fieldsList:qe(a,s)}),x.a.createElement(Re,{limit:a.limit||20,onLimitChange:function(t){void 0===t&&(t=20);var n=o(o({},a),{limit:t});e.onBuilderOptionsChange(n)}}))):null},Pe=function(e){var t=j.QueryEditor.QueryBuilder.PREVIEW,n=t.label,r=t.tooltip;return x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:r},n),x.a.createElement("pre",null,e.sql))},Qe=function(e){var t=e.query,n=e.onChange,r=j.QueryEditor.Types,a=r.label,i=r.tooltip,l=r.options,u=r.switcher,s=t.queryType||(t.rawSql&&!t.queryType?p.SQL:p.Builder),f=c(Object(w.useState)(s),2),m=f[0],v=f[1],h=c(Object(w.useState)(!1),2),b=h[0],g=h[1],E=[{label:l.SQLEditor,value:p.SQL},{label:l.QueryBuilder,value:p.Builder}],C=function(e,r){var a;if(void 0===r&&(r=!1),t.queryType!==p.SQL||e!==p.Builder||r){v(e);var i=void 0;switch(t.queryType){case p.Builder:i=t.builderOptions;break;case p.SQL:i=(null===(a=t.meta)||void 0===a?void 0:a.builderOptions)||y.builderOptions;default:i=y.builderOptions}e===p.SQL?n(o(o({},t),{queryType:e,rawSql:de(i),meta:{builderOptions:i},format:d.TABLE})):e===p.Builder&&n(o(o({},t),{queryType:e,rawSql:de(i),builderOptions:i}))}else g(!0)};return x.a.createElement(x.a.Fragment,null,x.a.createElement(N.InlineFormLabel,{width:8,className:"query-keyword",tooltip:i},a),x.a.createElement(N.RadioButtonGroup,{options:E,value:m,onChange:function(e){return C(e)}}),x.a.createElement(N.ConfirmModal,{isOpen:b,title:u.title,body:u.body,confirmText:u.confirmText,dismissText:u.dismissText,icon:"exclamation-triangle",onConfirm:function(){C(p.Builder,!0),g(!1)},onDismiss:function(){return g(!1)}}))},Ge=function(e){var t=e.query,n=e.onChange;switch(t.queryType){case p.SQL:return x.a.createElement("div",{"data-testid":"query-editor-section-sql"},x.a.createElement(X,o({},e)));case p.Builder:default:var r=o({},t);if(t.rawSql&&!t.builderOptions)return x.a.createElement("div",{"data-testid":"query-editor-section-sql"},x.a.createElement(X,o({},e)));if(!t.rawSql||!t.builderOptions){var a=y.rawSql,i=y.builderOptions;r=o(o({},r),{rawSql:a,builderOptions:i})}return x.a.createElement("div",{"data-testid":"query-editor-section-builder"},x.a.createElement(Me,{datasource:e.datasource,builderOptions:r.builderOptions,onBuilderOptionsChange:function(e){var r=de(e),a=e.mode===m.Trend?d.TIMESERIES:d.TABLE;n(o(o({},t),{queryType:p.Builder,rawSql:r,builderOptions:e,format:a}))}}),x.a.createElement(Pe,{sql:r.rawSql}))}};n.d(t,"plugin",(function(){return We}));var We=new r.DataSourcePlugin(A).setConfigEditor((function(e){var t,n=Object(N.useTheme)(),a=N.LegacyForms.FormField,i=N.LegacyForms.SecretFormField,l=e.options,u=e.onOptionsChange,c=l.jsonData,s=l.secureJsonFields,f=l.secureJsonData||{},d=s&&s.tlsCACert,p=s&&s.tlsClientCert,m=s&&s.tlsClientKey,v={padding:"0 "+n.spacing.sm,height:n.spacing.formInputHeight+"px",display:"flex",alignItems:"center"},h=function(e,t){var n;u(o(o({},l),{jsonData:o(o({},l.jsonData),(n={},n[e]=t,n))}))},b=function(e,t){var n;u(o(o({},l),{secureJsonData:o(o({},f),(n={},n[e]=t,n))}))},g=function(e){var t,n;u(o(o({},l),{secureJsonFields:o(o({},s),(t={},t[e]=!1,t)),secureJsonData:o(o({},f),(n={},n[e]="",n))}))};return x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{className:"gf-form-group"},x.a.createElement("h3",null,"Server"),x.a.createElement("br",null),x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:12,tooltip:_.ConfigEditor.Secure.tooltip},_.ConfigEditor.Secure.label),x.a.createElement("div",{style:v},x.a.createElement(N.Switch,{css:{},className:"gf-form",value:c.secure||!1,onChange:function(e){return function(e,t){var n;u(o(o({},l),{jsonData:o(o({},l.jsonData),(n={},n[e]=t,n))}))}("secure",e.currentTarget.checked)}}))),x.a.createElement("div",{className:"gf-form"},x.a.createElement(a,{labelWidth:12,inputWidth:20,value:c.server||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(e,"server"),label:_.ConfigEditor.ServerAddress.label,"aria-label":_.ConfigEditor.ServerAddress.label,placeholder:_.ConfigEditor.ServerAddress.placeholder,tooltip:_.ConfigEditor.ServerAddress.tooltip})),x.a.createElement("div",{className:"gf-form"},x.a.createElement(a,{labelWidth:12,inputWidth:20,type:"number",value:c.port||"",onChange:function(e){return t=e.currentTarget.value,void u(o(o({},l),{jsonData:o(o({},l.jsonData),{port:+t})}));var t},label:_.ConfigEditor.ServerPort.label,"aria-label":_.ConfigEditor.ServerPort.label,placeholder:_.ConfigEditor.ServerPort.placeholder((null===(t=c.secure)||void 0===t?void 0:t.toString())||"false"),tooltip:_.ConfigEditor.ServerPort.tooltip}))),x.a.createElement("div",{className:"gf-form-group"},x.a.createElement("h3",null,"Credentials"),x.a.createElement("br",null),x.a.createElement("div",{className:"gf-form"},x.a.createElement(a,{labelWidth:12,inputWidth:20,value:c.username||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(e,"username"),label:_.ConfigEditor.Username.label,"aria-label":_.ConfigEditor.Username.label,placeholder:_.ConfigEditor.Username.placeholder,tooltip:_.ConfigEditor.Username.tooltip})),x.a.createElement("div",{className:"gf-form"},x.a.createElement(i,{labelWidth:12,inputWidth:20,required:!0,value:f.password||"",isConfigured:s&&s.password,onReset:function(){u(o(o({},l),{secureJsonFields:o(o({},l.secureJsonFields),{password:!1}),secureJsonData:o(o({},l.secureJsonData),{password:""})}))},onChange:Object(r.onUpdateDatasourceSecureJsonDataOption)(e,"password"),label:_.ConfigEditor.Password.label,"aria-label":_.ConfigEditor.Password.label,placeholder:_.ConfigEditor.Password.placeholder,tooltip:_.ConfigEditor.Password.tooltip}))),x.a.createElement("div",{className:"gf-form-group"},x.a.createElement("h3",null,"TLS / SSL Settings"),x.a.createElement("br",null),x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:12,tooltip:_.ConfigEditor.TLSSkipVerify.tooltip},_.ConfigEditor.TLSSkipVerify.label),x.a.createElement("div",{style:v},x.a.createElement(N.Switch,{css:{},className:"gf-form",value:c.tlsSkipVerify||!1,onChange:function(e){return h("tlsSkipVerify",e.currentTarget.checked)}}))),x.a.createElement("div",{className:"gf-form"},x.a.createElement(N.InlineFormLabel,{width:12,tooltip:_.ConfigEditor.TLSClientAuth.tooltip},_.ConfigEditor.TLSClientAuth.label),x.a.createElement("div",{style:v},x.a.createElement(N.Switch,{css:{},className:"gf-form",value:c.tlsAuth||!1,onChange:function(e){return h("tlsAuth",e.currentTarget.checked)}})),x.a.createElement(N.InlineFormLabel,{width:12,tooltip:_.ConfigEditor.TLSAuthWithCACert.tooltip},_.ConfigEditor.TLSAuthWithCACert.label),x.a.createElement("div",{style:v},x.a.createElement(N.Switch,{css:{},className:"gf-form",value:c.tlsAuthWithCACert||!1,onChange:function(e){return h("tlsAuthWithCACert",e.currentTarget.checked)}}))),c.tlsAuthWithCACert&&x.a.createElement(I,{hasCert:!!d,onChange:function(e){return b("tlsCACert",e.currentTarget.value)},placeholder:_.ConfigEditor.TLSCACert.placeholder,label:_.ConfigEditor.TLSCACert.label,onClick:function(){return g("tlsCACert")}}),c.tlsAuth&&x.a.createElement(x.a.Fragment,null,x.a.createElement(I,{hasCert:!!p,onChange:function(e){return b("tlsClientCert",e.currentTarget.value)},placeholder:_.ConfigEditor.TLSClientCert.placeholder,label:_.ConfigEditor.TLSClientCert.label,onClick:function(){return g("tlsClientCert")}}),x.a.createElement(I,{hasCert:!!m,placeholder:_.ConfigEditor.TLSClientKey.placeholder,label:_.ConfigEditor.TLSClientKey.label,onChange:function(e){return b("tlsClientKey",e.currentTarget.value)},onClick:function(){return g("tlsClientKey")}}))),x.a.createElement("div",{className:"gf-form-group"},x.a.createElement("h3",null,"Additional Properties"),x.a.createElement("br",null),x.a.createElement("div",{className:"gf-form"},x.a.createElement(a,{labelWidth:12,inputWidth:20,value:c.defaultDatabase||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(e,"defaultDatabase"),label:_.ConfigEditor.DefaultDatabase.label,"aria-label":_.ConfigEditor.DefaultDatabase.label,placeholder:_.ConfigEditor.DefaultDatabase.placeholder,tooltip:_.ConfigEditor.DefaultDatabase.tooltip}))))})).setQueryEditor((function(e){var t=e.query,n=e.onChange,r=e.onRunQuery;return x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{className:"gf-form "+H.QueryEditor.queryType},x.a.createElement("span",null,x.a.createElement(Qe,o({},e))),x.a.createElement(N.Button,{onClick:function(){return function(){if(t.queryType===p.SQL){var e=K(t.rawSql);e!==t.format&&n(o(o({},t),{format:e})),r()}}()}},"Run Query")),x.a.createElement(Ge,o({},e)))}))}])}));
//# sourceMappingURL=module.js.map