define(["lodash","@grafana/data","d3","@grafana/ui","app/core/utils/kbn","jquery","app/plugins/sdk","app/core/time_series2","app/core/config","app/core/core_module"],(function(t,e,a,r,i,o,s,n,l,h){return function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=12)}([function(e,a){e.exports=t},function(t,a){t.exports=e},function(t,e){t.exports=a},function(t,e){t.exports=r},function(t,e){t.exports=i},function(t,e){t.exports=o},function(t,e){t.exports=s},function(t,e){t.exports=n},function(t,e){t.exports=l},function(t,e){t.exports=h},,,function(t,e,a){"use strict";a.r(e);var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])})(t,e)};var i=function(){return(i=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var i in e=arguments[a])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.create;function o(t){var e="function"==typeof Symbol&&Symbol.iterator,a=e&&t[e],r=0;if(a)return a.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var a="function"==typeof Symbol&&t[Symbol.iterator];if(!a)return t;var r,i,o=a.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}return s}Object.create;var n=a(6),l=a(0),h=a.n(l),p=a(5),u=a.n(p),c=a(4),d=a.n(c),f=a(7),m=a.n(f),v=a(2),g=Math.PI/3,y=[0,g,2*g,3*g,4*g,5*g];function b(t){return t[0]}function x(t){return t[1]}function T(t,e){if(h.a.isNumber(e))return{decimals:e,scaledDecimals:null};var a,r=t/2,i=-Math.floor(Math.log(r)/Math.LN10),o=Math.pow(10,-i),s=r/o;s<1.5?a=1:s<3?(a=2,s>2.25&&(a=2.5,++i)):a=s<7.5?5:10,a*=o,Math.floor(t)===t&&(i=0);var n={decimals:0,scaledDecimals:0};return n.decimals=Math.max(0,i),n.scaledDecimals=n.decimals-Math.floor(Math.log(a)/Math.LN10)+2,n}function w(t,e){var a=document.createElement("canvas").getContext("2d");return a.font=e,a.measureText(t).width}function C(t,e,a){if(0===a)return t;var r=a%2==0;switch(Math.ceil(a/2)){case 1:t=h.a.sortBy(t,e);break;case 2:t=h.a.sortBy(t,(function(t){if(isNaN(t[e])){var a=t[e].match(/.*?(\d+).*/);return!a||a.length<2?-1:parseInt(a[1],10)}return r=t[e],isNaN(r)?r:Number(r);var r}));break;case 3:t=h.a.sortBy(t,(function(t){var a=t[e];return isNaN(a)?h.a.toLower(t[e]):a}))}return r&&(t=t.reverse()),t}var S,N=function(){function t(t,e,a){this.r=t,this.g=e,this.b=a}return t.prototype.asHex=function(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)},t.prototype.asRGB=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},t.prototype.blendWith=function(e,a){return new t(Math.round(e.r*(1-a)+this.r*a),Math.round(e.g*(1-a)+this.g*a),Math.round(e.b*(1-a)+this.b*a))},t.prototype.Mul=function(e,a){return new t(Math.round(e.r/255*this.r*a),Math.round(e.g/255*this.g*a),Math.round(e.b/255*this.b*a))},t.prototype.RGBToHex=function(t){var e=t.indexOf(",")>-1?",":" ";for(var a in t=t.substr(4).split(")")[0].split(e)){var r=t[a];r.indexOf("%")>-1&&(t[a]=Math.round(r.substr(0,r.length-1)/100*255))}},t.RGBAToHex=function(t){var e,a=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),r=(a&&a[4]||"").trim(),i=a?(256|parseInt(a[1],10)).toString(16).slice(1)+(256|parseInt(a[2],10)).toString(16).slice(1)+(256|parseInt(a[3],10)).toString(16).slice(1):t;""!==r?e=(255*parseFloat(r)|256).toString(16).slice(1):e=1;return"#"+i+e},t.prototype.fromHex=function(t){t=t.substring(1,7);var e=parseInt(t,16);this.r=e>>16&255,this.g=e>>8&255,this.b=255&e},t.createGradients=function(e){for(var a=[],r=new t(255,255,255),i=0;i<e.length;i++){var o=new t(0,0,0),s=e[i].color;s.startsWith("rgba")&&(s=this.RGBAToHex(s)),o.fromHex(s);var n=o.Mul(r,.7);a.push({start:o.asHex(),end:n.asHex()})}return a},t}(),R=function(){};!function(t){t.HEXAGON_POINTED_TOP="hexagon_pointed_top",t.CIRCLE="circle",t.SQUARE="square"}(S||(S={}));var O=function(){function t(t,e,a,r,i,o,s){this.SQRT3=1.7320508075688772,this.width=t,this.height=e,this.numColumns=a,this.numRows=r,this.maxColumnsUsed=0,this.maxRowsUsed=0,this.displayLimit=i,this.shape=s,this.radius=0,this.autoSize=o}return t.prototype.setRadius=function(t){this.radius=t},t.prototype.setHeight=function(t){this.height=t},t.prototype.setWidth=function(t){this.width=t},t.prototype.generateHexagonPointedTopLayout=function(){return this.radius=this.getHexFlatTopRadius(),{}},t.prototype.generateUniformLayout=function(){return this.radius=this.getUniformRadius(),{}},t.prototype.getHexFlatTopRadius=function(){var t=v.min([this.width/((this.numColumns+.5)*this.SQRT3),this.height/(1.5*(this.numRows+1/3))]);return t-=0,this.truncateFloat(t)},t.prototype.getHexFlatTopDiameters=function(){var t=this.getHexFlatTopRadius();return{diameterX:this.truncateFloat(t*this.SQRT3),diameterY:this.truncateFloat(2*t)}},t.prototype.getUniformDiameters=function(){var t=this.getUniformRadius();return{diameterX:2*t,diameterY:2*t}},t.prototype.getUniformRadius=function(){var t=this.width/this.maxColumnsUsed*.5,e=this.height/this.maxRowsUsed*.5,a=t;return a>e&&(a=e),a-=0,this.truncateFloat(a)},t.prototype.generatePossibleColumnAndRowsSizes=function(t,e,a){if(e&&t){var r=Math.sqrt(a);this.width>this.height?(this.numColumns=Math.ceil(this.width/this.height*r*.75),this.numColumns<1?this.numColumns=1:this.numColumns>a&&(this.numColumns=a),this.numRows=Math.ceil(a/this.numColumns),this.numRows<1&&(this.numRows=1)):(this.numRows=Math.ceil(this.height/this.width*r*.75),this.numRows<1?this.numRows=1:this.numRows>a&&(this.numRows=a),this.numColumns=Math.ceil(a/this.numRows),this.numColumns<1&&(this.numColumns=1))}else e?(this.numRows=Math.ceil(a/this.numColumns),this.numRows<1&&(this.numRows=1)):t&&(this.numColumns=Math.ceil(a/this.numRows),this.numColumns<1&&(this.numColumns=1))},t.prototype.generateActualColumnAndRowUsage=function(t,e){for(var a=0,r=0,i=0,o=0,s=0;s<this.numRows;s++)if((!e||a<e)&&a<t.length){r+=1,i=0;for(var n=0;n<this.numColumns;n++)(!e||a<e)&&a<t.length&&((i+=1)>o&&(o=i),a++)}this.maxRowsUsed=r,this.maxColumnsUsed=o},t.prototype.shapeToCoordinates=function(t,e,a,r){switch(t){case S.HEXAGON_POINTED_TOP:var i=e*a*this.SQRT3;return r%2==1&&(i+=e*this.SQRT3/2),[i,e*r*1.5];case S.CIRCLE:case S.SQUARE:return[e*a*2,e*r*2];default:return[e*a*1.75,e*r*1.5]}},t.prototype.generatePoints=function(t,e,a){var r=[];if(void 0===t)return r;var i=0,o=0,s=0;if(this.numRows===1/0)return r;if(isNaN(this.numColumns))return r;for(var n=0;n<this.numRows;n++)if((!e||r.length<e)&&r.length<t.length){i+=1,o=0;for(var l=0;l<this.numColumns;l++)(!e||r.length<e)&&r.length<t.length&&((o+=1)>s&&(s=o),r.push(this.shapeToCoordinates(a,this.radius,l,n)))}return this.maxRowsUsed=i,this.maxColumnsUsed=s,r},t.prototype.generateUniformPoints=function(t,e){var a=[];if(void 0===t)return a;var r=0,i=0,o=0,s=1,n=1;if(this.numRows===1/0)return a;if(isNaN(this.numColumns))return a;for(var l=0;l<this.numRows;l++)if((!e||a.length<e)&&a.length<t.length){r+=1,i=0;for(var h=0;h<this.numColumns;h++)(!e||a.length<e)&&a.length<t.length&&((i+=1)>o&&(o=i),a.push({x:s,y:n,width:2*this.radius,height:2*this.radius}),s+=2*this.radius);s=1,n+=2*this.radius}return this.maxRowsUsed=r,this.maxColumnsUsed=o,a},t.prototype.getRadius=function(){return this.radius},t.prototype.generateRadius=function(t){if(!this.autoSize)return this.radius;var e=0;switch(t){case S.HEXAGON_POINTED_TOP:e=this.getHexFlatTopRadius();break;case S.CIRCLE:case S.SQUARE:e=this.getUniformRadius();break;default:e=this.getHexFlatTopRadius()}return this.radius=e,e},t.prototype.truncateFloat=function(t){if(t===1/0||isNaN(t))return 0;var e=t.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return Number(e)},t.prototype.getOffsets=function(t,e){switch(t){case S.HEXAGON_POINTED_TOP:return this.getOffsetsHexagonPointedTop(e);case S.SQUARE:return this.getOffsetsSquare(e);case S.CIRCLE:default:return this.getOffsetsUniform(e)}},t.prototype.getOffsetsHexagonPointedTop=function(t){var e=v.min([this.width/((this.numColumns+.5)*this.SQRT3),this.height/(1.5*(this.numRows+1/3))]);e=this.truncateFloat(e);var a=this.truncateFloat(e*this.SQRT3),r=this.truncateFloat(2*e),i=.5*r,o=this.getOddEvenCountForRange(1,this.maxRowsUsed),s=o.oddCount*r+o.evenCount*r*.5,n=(this.height-s)/2;n=-(n+i);var l=.5*a,h=0;this.numRows>1&&t>=2*this.maxColumnsUsed&&(h=.5);var p=(this.numColumns+h)*a,u=(this.width-p)/2;return{xoffset:u=-(u+l),yoffset:n}},t.prototype.getOffsetsUniform=function(t){var e=this.getDiameters(),a=e.diameterX,r=e.diameterY,i=this.truncateFloat(a),o=this.truncateFloat(r),s=.5*o,n=this.maxRowsUsed*o,l=(this.height-n)/2;l=-(l+s);var h=.5*i,p=this.numColumns*i,u=(this.width-p)/2;return{xoffset:u=-(u+h),yoffset:l}},t.prototype.getOffsetsSquare=function(t){var e=this.getDiameters(),a=e.diameterX,r=e.diameterY,i=this.truncateFloat(a),o=this.truncateFloat(r),s=this.maxRowsUsed*o,n=(this.height-s)/2;n=-(n+0);var l=this.numColumns*i,h=(this.width-l)/2;return{xoffset:h=-(h+0),yoffset:n}},t.prototype.getOddEvenCountForRange=function(t,e){var a=(e-t)/2;return e%2==0&&t%2==0||a++,{oddCount:a,evenCount:e-t+1-a}},t.prototype.getDiameters=function(){switch(this.shape){case S.HEXAGON_POINTED_TOP:return this.getHexFlatTopDiameters();case S.SQUARE:case S.CIRCLE:default:return this.getUniformDiameters()}},t}();function D(t){return!("showName"in t)||t.showName}function F(){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=v.event.pageX-50;return e<0&&(e=0),e+200>t&&(e=t-200),{xpos:e,ypos:v.event.pageY+5}}var E=function(){function t(t,e,a,r){this.minFont=6,this.maxFont=240,this.templateSrv=t,this.svgContainer=e,this.d3DivId=a,this.data=r.data,this.opt=r,this.purelight=new N(255,255,255),this.data=this.opt.data,this.lm=new O(this.opt.width,this.opt.height,r.columns||6,r.rows||6,this.opt.displayLimit,this.opt.radiusAutoSize,this.opt.polystat.shape),this.lm.generatePossibleColumnAndRowsSizes(this.opt.columnAutoSize,this.opt.rowAutoSize,this.data.length),this.lm.generateActualColumnAndRowUsage(this.data,r.displayLimit),!r.radiusAutoSize&&r.radius?this.lm.setRadius(r.radius):this.lm.generateRadius(this.opt.polystat.shape),this.calculatedPoints=this.lm.generatePoints(this.data,r.displayLimit,this.opt.polystat.shape)}return t.prototype.computeTextFontSize=function(t,e,a,r){return function(t,e,a,r,i,o){var s=e.replace("?",o),n=w(t,s);if(n<=(a*=.95)&&o<=r)return o;for(var l=o;l>=i;l--)if((n=w(t,s=e.replace("?",l)))<a&&l<=r)return Math.ceil(l);return 0}(t,"?px sans-serif",a,r/e,this.minFont,this.maxFont)},t.prototype.draw=function(){var t=this,e=0,a=0,r=this.opt.width,i=this.opt.height,o=function(){var t,e,a,r=0,i=0,o=1,s=1,n=b,l=x;function h(t){var r,i={},o=[],s=t.length;for(r=0;r<s;++r)if(!isNaN(p=+n.call(null,h=t[r],r,t))&&!isNaN(u=+l.call(null,h,r,t))){var h,p,u,c=Math.round(u/=a),d=Math.round(p=p/e-(1&c)/2),f=u-c;if(3*Math.abs(f)>1){var m=p-d,v=d+(p<d?-1:1)/2,g=c+(u<c?-1:1),y=p-v,b=u-g;m*m+f*f>y*y+b*b&&(d=v+(1&c?1:-1)/2,c=g)}var x=d+"-"+c,T=i[x];T?T.push(h):(o.push(T=i[x]=[h]),T.x=(d+(1&c)/2)*e,T.y=c*a)}return o}function p(t){var e=0,a=0;return y.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,s=i-e,n=o-a;return e=i,a=o,[s,n]}))}return h.hexagon=function(e){return"m"+p(null==e?t:+e).join("l")+"z"},h.centers=function(){for(var n=[],l=Math.round(i/a),h=Math.round(r/e),p=l*a;p<s+t;p+=a,++l)for(var u=h*e+(1&l)*e/2;u<o+e/2;u+=e)n.push([u,p]);return n},h.mesh=function(){var e=p(t).slice(0,4).join("l");return h.centers().map((function(t){return"M"+t+"m"+e})).join("")},h.x=function(t){return arguments.length?(n=t,h):n},h.y=function(t){return arguments.length?(l=t,h):l},h.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(g),a=1.5*t,h):t},h.size=function(t){return arguments.length?(r=i=0,o=+t[0],s=+t[1],h):[o-r,s-i]},h.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],s=+t[1][1],h):[[r,i],[o,s]]},h.radius(1)}().radius(this.lm.generateRadius(this.opt.polystat.shape)).extent([[0,0],[r,i]]),s=this.lm.getDiameters(),n=s.diameterX,l=s.diameterY,h=this.lm.getOffsets(this.opt.polystat.shape,this.data.length),p=h.xoffset,u=h.yoffset,c=v.select("body").append("div").attr("id",this.d3DivId+"-tooltip").attr("class","polystat-panel-tooltip").style("opacity",0);!1===this.opt.polystat.tooltipEnabled&&c.style("display","none");for(var d=v.select(this.svgContainer).attr("width",r+"px").attr("height",i+"px").append("svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width","100%").attr("height","100%").attr("viewBox",p+","+u+", "+r+", "+i).style("border","0px solid white").attr("id",this.d3DivId).append("g").attr("transform","translate("+a+","+e+")"),f=this.data,m=d.append("defs"),T=N.createGradients(f),w=0;w<T.length;w++){var C=m.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-data-"+w);C.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),C.append("stop").attr("offset","0%").attr("stop-color",T[w].start),C.append("stop").attr("offset","100%").attr("stop-color",T[w].end)}var R=new N(82,194,52),O=R.Mul(this.purelight,.7),E=m.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-ok");E.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),E.append("stop").attr("offset","0%").attr("stop-color",R.asHex()),E.append("stop").attr("offset","100%").attr("stop-color",O.asHex());var M=new N(255,200,55),k=M.Mul(this.purelight,.7),L=m.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-warning");L.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),L.append("stop").attr("offset","0%").attr("stop-color",M.asHex()),L.append("stop").attr("offset","100%").attr("stop-color",k.asHex());var P=new N(229,45,39),z=P.Mul(this.purelight,.7),A=m.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-critical");A.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),A.append("stop").attr("offset","0%").attr("stop-color",P.asHex()),A.append("stop").attr("offset","100%").attr("stop-color",z.asHex());var I=m.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-unknown");I.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),I.append("stop").attr("offset","0%").attr("stop-color","#73808A"),I.append("stop").attr("offset","100%").attr("stop-color","#757F9A");var _=null,U=n,V=l/2,j=n*l;n<l&&(j=n*n),l<n&&(j=l*l);var $=v.symbol().size(j);switch(this.opt.polystat.shape){case S.HEXAGON_POINTED_TOP:_=o.hexagon(this.lm.getRadius());break;case S.CIRCLE:_=$.type(v.symbolCircle);break;case S.SQUARE:_=$.type(v.symbolSquare);break;default:_=o.hexagon(this.lm.getRadius())}var H=this.opt.polystat.fontSize,B=this.opt.polystat.fontSize,G=!1,W=0;if(this.opt.polystat.fontAutoScale){var Q="";for(w=0;w<this.data.length;w++)this.data[w].name.length>Q.length&&(Q=this.data[w].name);var X="";for(w=0;w<this.data.length;w++){this.data[w].valueFormatted.length>X.length&&(X=this.data[w].valueFormatted);var Y=this.data[w].members.length;if(Y>0)for(var q=0;q<Y;){var J=Object.assign({},this.data[w]),K=this.formatValueContent(q,J);K&&K.length>X.length&&(X=K),q++}}H=this.computeTextFontSize(Q,2,U,V),B=this.computeTextFontSize(X,2,U,V),H<this.minFont&&(G=!0,W=18,Q=Q.substring(0,W+2),(H=this.computeTextFontSize(Q,2,U,V))<this.minFont&&(W=10,Q=Q.substring(0,W+2),(H=this.computeTextFontSize(Q,2,U,V))<this.minFont&&(W=6,Q=Q.substring(0,W+2),H=this.computeTextFontSize(Q,2,U,V)))),B>H&&(B=H),this.opt.polystat.valueEnabled||(B=0)}var Z=V/2/2+B/2,tt=B/2,et=-V/2/2+H/2,at=H/2,rt=0,it=0,ot=this.opt.polystat.shape;d.selectAll("."+ot).data(ot===S.HEXAGON_POINTED_TOP?o(this.calculatedPoints):this.calculatedPoints).enter().each((function(e,a,r){var i,o,s=v.select(r[a]),n=function(t){var e=t.clickThrough;return!0===t.sanitizeURLEnabled&&t.sanitizedURL.length>0&&(e=t.sanitizedURL),e}(f[a]);n.length>0&&(s=s.append("a").attr("target",(i=f[a],o="_self",!0===i.newTabEnabled&&(o="_blank"),o)).attr("xlink:href",n));var l=f[a].color;switch(t.opt.polystat.gradientEnabled&&(l='url("#'+t.d3DivId+"linear-gradient-state-data-"+a+'")'),ot){case S.HEXAGON_POINTED_TOP:s=s.append("path").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).attr("d",_);break;case S.CIRCLE:var h=t.lm.generateRadius(ot);s=s.append("circle").attr("class","circle").attr("cx",(function(t){return t[0]})).attr("cy",(function(t){return t[1]})).attr("r",h);break;case S.SQUARE:var p=t.lm.generateRadius(ot);s=s.append("rect").attr("class","rect").attr("x",(function(t){return t[0]})).attr("y",(function(t){return t[1]})).attr("height",2*p).attr("width",2*p)}s=s.attr("stroke",t.opt.polystat.polygonBorderColor).attr("stroke-width",t.opt.polystat.polygonBorderSize+"px").style("fill",l).on("mousemove",(function(){var t=F(),e=t.xpos,a=t.ypos;c.style("left",e+"px").style("top",a+"px")})).on("mouseover",(function(e){var r=F(),i=r.xpos,o=r.ypos;c.transition().duration(200).style("opacity",.9),c.html(t.opt.tooltipContent[a]).style("font-size",t.opt.tooltipFontSize).style("font-family",t.opt.tooltipFontType).style("left",i+"px").style("top",o+"px")})).on("mouseout",(function(){c.transition().duration(500).style("opacity",0)}))}));var st=null;switch(this.opt.polystat.shape){case S.HEXAGON_POINTED_TOP:st=d.selectAll("text.toplabel").data(o(this.calculatedPoints)),at=.37*H;break;case S.CIRCLE:st=d.selectAll("text.toplabel").data(this.miscbin(this.calculatedPoints)),at=.37*H;break;case S.SQUARE:st=d.selectAll("text.toplabel").data(this.miscbin(this.calculatedPoints)),Z=l/1.5+B/2,tt=l/2+.37*H,et=l/4+H/2,at=l/2+.37*H,rt=n/2,it=n/2}st.enter().append("text").attr("class","toplabel").attr("x",(function(t){return t.x+rt})).attr("y",(function(t,e){var a=f[e],r=at;return function(t){return!("showValue"in t)||t.showValue}(a)&&(r=et),t.y+r})).attr("text-anchor","middle").attr("font-family",this.opt.polystat.fontType).attr("font-size",H+"px").attr("fill",this.opt.polystat.fontColor).style("pointer-events","none").text((function(e,a){var r=f[a];return D(r)?G?r.name.substring(0,W)+"...":!t.opt.polystat.fontAutoScale&&t.opt.polystat.ellipseEnabled&&r.name.length>t.opt.polystat.ellipseCharacters?r.name.substring(0,t.opt.polystat.ellipseCharacters)+"...":r.name:""}));var nt=new Array(f.length).fill(0);st.enter().append("text").attr("class",(function(t,e){return"valueLabel"+e})).attr("x",(function(t){return t.x+it})).attr("y",(function(t,e){var a=f[e],r=tt;return D(a)&&(r=Z),t.y+r})).attr("text-anchor","middle").attr("font-family",this.opt.polystat.fontType).attr("fill",this.opt.polystat.fontColor).attr("font-size",B+"px").style("pointer-events","none").text((function(e,a){for(var r=0,i=t.data.length,o=null;null===o&&r<i;){var s=Object.assign({},t.data[a]);if(null!==(o=t.formatValueContent(nt[a]+r,s)))break;r++}return d.select("text.valueLabel"+a).attr("font-size",B+"px"),v.interval((function(e){var r=d.select("text.valueLabel"+a),i=a;r.text((function(){r.attr("font-size",B+"px");for(var e=null,a=0,o=2*t.data.length;null===e&&a<o;){var s=Object.assign({},t.data[i]);e=t.formatValueContent(nt[i]+a,s),a++}return null===e?"":(""===e&&(e=""),e)})),nt[a]++}),t.opt.animationSpeed),o}))},t.prototype.miscbin=function(t){for(var e=0;e<t.length;e++)t[e].x=t[e][0],t[e].y=t[e][1];return t},t.prototype.formatValueContent=function(t,e){if(void 0===e)return"";if(e.hasOwnProperty("showValue")&&!e.showValue)return"";if(!e.hasOwnProperty("valueFormatted"))return"";switch(e.animateMode){case"all":break;case"triggered":if(e.thresholdLevel<1)return""}var a=e.valueFormatted;if(!a)return null;e.prefix&&e.prefix.length>0&&(a=e.prefix+" "+a),e.suffix&&e.suffix.length>0&&(a=a+" "+e.suffix);var r=e.members.length;if(r>0){var i=-1;if("all"===e.animateMode)i=t%r;else{void 0===e.triggerCache&&(e.triggerCache=this.buildTriggerCache(e));var o=t%e.triggerCache.length;i=e.triggerCache[o].index}var s=Object.assign({},e.members[i]);a=s.name+": "+s.valueFormatted,s.prefix&&s.prefix.length>0&&(a=s.prefix+" "+a),s.suffix&&s.suffix.length>0&&(a=a+" "+s.suffix)}if(a&&a.length>0)try{a=this.templateSrv.replace(a,"text")}catch(t){}return a},t.prototype.buildTriggerCache=function(t){for(var e=[],a=0;a<t.members.length;a++){var r=t.members[a];if(r.thresholdLevel>0){var i={index:a,name:r.name,value:r.value,thresholdLevel:r.thresholdLevel};e.push(i)}}return e=h.a.orderBy(e,["thresholdLevel","value","name"],["desc","desc","asc"])},t}();function M(t,e){var a=(e=e||{}).delimiter||".",r=e.maxDepth||3,i=1,o={};return function t(s,n){Object.keys(s).forEach((function(l){var h=s[l],p=e.safe&&Array.isArray(h),u="[object Object]"===Object.prototype.toString.call(h),c=n?n+a+l:l;if(e.maxDepth||(r=i+1),!p&&u&&Object.keys(h).length&&i<r)return++i,t(h,c);o[c]=h}))}(t,null),o}var k=function(){function t(t,e){if(null!==e){this.animateMode="all",this.displayMode="all",this.operatorName=t,this.name=e.alias;var a=this.getValueByOperator(t,e);this.value=a,this.valueFormatted=a,this.stats=e.stats,e.datapoints.length>0&&(this.timestamp=e.datapoints[e.datapoints.length-1][1]),this.prefix="",this.suffix="",this.seriesRaw=null,this.color="green",this.clickThrough="",this.sanitizedURL="",this.newTabEnabled=!0,this.sanitizeURLEnabled=!0,this.isComposite=!1,this.members=[],this.thresholdLevel=0,this.showName=!0,this.showValue=!0}}return t.prototype.getValueByOperator=function(t,e){var a=e.stats.avg;switch(t){case"avg":a=e.stats.avg;break;case"count":a=e.stats.count;break;case"current":a=e.stats.current;break;case"delta":a=e.stats.delta;break;case"diff":a=e.stats.diff;break;case"first":a=e.stats.first;break;case"logmin":a=e.stats.logmin;break;case"max":a=e.stats.max;break;case"min":a=e.stats.min;break;case"name":a=e.metricName;break;case"time_step":a=e.stats.timeStep;break;case"last_time":a=e.timestamp;break;case"total":a=e.stats.total;break;default:a=e.stats.avg}return a},t.prototype.shallowClone=function(){var e=new t(this.operatorName,null);return e.operatorName=this.operatorName,e.thresholdLevel=this.thresholdLevel,e.value=this.value,e.valueFormatted=this.valueFormatted,e.name=this.name,e.timestamp=this.timestamp,e.prefix=this.prefix,e.suffix=this.suffix,e.seriesRaw=null,e.color=this.color,e.clickThrough=this.clickThrough,e.newTabEnabled=this.newTabEnabled,e.sanitizedURL=this.sanitizedURL,e.sanitizeURLEnabled=this.sanitizeURLEnabled,e.isComposite=this.isComposite,e.members=[],e},t.prototype.deepClone=function(){var e=new t(this.operatorName,null);return e.operatorName=this.operatorName,e.thresholdLevel=this.thresholdLevel,e.value=this.value,e.valueFormatted=this.valueFormatted,e.name=this.name,e.timestamp=this.timestamp,e.prefix=this.prefix,e.suffix=this.suffix,e.seriesRaw=this.seriesRaw,e.color=this.color,e.clickThrough=this.clickThrough,e.sanitizedURL=this.sanitizedURL,e.newTabEnabled=this.newTabEnabled,e.sanitizeURLEnabled=this.sanitizeURLEnabled,e.isComposite=this.isComposite,e.members=[],e},t}(),L=function(){function t(){}return t.TimeSeriesToPolystat=function(t,e){return new k(t,e)},t.GetColumnsJSONData=function(t){if(!t||0===t.length)return[];for(var e={},a=0;a<t.length;a++){var r=t[a];if("docs"===r.type)for(var i=Math.min(r.datapoints.length,100),o=0;o<i;o++){var s=M(r.datapoints[o],null);for(var n in s)s.hasOwnProperty(n)&&(e[n]=!0)}}return h.a.map(e,(function(t,e){return{text:e,value:t}}))},t}();function P(t,e){var a=t,r=t.thresholdLevel,i=e.thresholdLevel;if(i>r&&(a=e),3===r)switch(i){case 1:case 2:a=e}return a}function z(t,e,a){var r=a;if(null===e)return{thresholdLevel:3,color:"#808080"};var i=-1;if(void 0===t)return{thresholdLevel:i,color:a};var o=t.length;if(0===o)return{thresholdLevel:i,color:a};var s=t[o-1];if(e>=s.value&&(i=s.state,r=s.color),1===t.length)return{thresholdLevel:i,color:r};for(var n=o-1;n>0;n--){var l=t[n],h=t[n-1];h.value<=e&&e<l.value&&i<h.state&&(i=h.state,r=h.color)}return-1===i&&(i=t[0].state,r=t[0].color),{thresholdLevel:i,color:r}}function A(t,e){var a=e.stats.avg;switch(t){case"avg":a=e.stats.avg;break;case"count":a=e.stats.count;break;case"current":a=e.stats.current;break;case"delta":a=e.stats.delta;break;case"diff":a=e.stats.diff;break;case"first":a=e.stats.first;break;case"logmin":a=e.stats.logmin;break;case"max":a=e.stats.max;break;case"min":a=e.stats.min;break;case"name":a=e.metricName;break;case"time_step":a=e.stats.timeStep;break;case"last_time":a=e.timestamp;break;case"total":a=e.stats.total;break;default:a=e.stats.avg}return a}var I,_=a(1),U=function(){function t(){}return t.transformSingleMetric=function(t,e,a){if(isNaN(t))return e;for(var r=a[t];e.match(this.cellName);)e=e.replace(this.cellName,r.name);for(;e.match(this.cellValue);)e=e.replace(this.cellValue,encodeURIComponent(r.valueFormatted));for(;e.match(this.cellRawValue);)e=e.replace(this.cellRawValue,r.value.toString());return e},t.transformNthMetric=function(t,e){for(;t.match(this.nthCellName);){if((i=t.match(this.nthCellName)).length>=2){var a=e[i[1]].name;t=t.replace(this.nthCellName,a)}}for(;t.match(this.nthCellValue);){if((i=t.match(this.nthCellValue)).length>=2){var r=e[i[1]].valueFormatted;t=t.replace(this.nthCellValue,encodeURIComponent(r))}}for(;t.match(this.nthCellRawValue);){var i;if((i=t.match(this.nthCellRawValue)).length>=2){r=e[i[1]].value;t=t.replace(this.nthCellRawValue,r.toString())}}return t},t.transformComposite=function(t,e){for(;e.match(this.compositeName);)e=e.replace(this.compositeName,t);return e},t.transformByRegex=function(t,e,a){var r=Object(_.stringToJsRegex)(t),i=e.name.match(r);if(i&&i.length>0&&i.forEach((function(t,e){var r=i[e],o="${"+e+"}",s="$"+e;a=(a=a.replace(o,r)).replace(s,r)})),i&&i.groups)for(var o in i.groups){var s=i.groups[o],n="${"+o+"}",l="$"+o;a=(a=a.replace(n,s)).replace(l,s)}return a},t.cellName=/\${__cell_name}/,t.cellValue=/\${__cell}/,t.cellRawValue=/\${__cell:raw}/,t.nthCellName=/\${__cell_name_(\d+)}/,t.nthCellValue=/\${__cell_(\d+)}/,t.nthCellRawValue=/\${__cell_(\d+):raw}/,t.compositeName=/\${__composite_name}/,t}();!function(t){t[t.ValueToText=1]="ValueToText",t[t.RangeToText=2]="RangeToText"}(I||(I={}));var V,j,$=function(t,e){var a=t.reduce((function(t,a){return a.type===I.ValueToText?t=function(t,e,a){if(void 0===e.value)return t;if(null===a&&B(e))return t.concat(e);var r=parseFloat(a),i=parseFloat(e.value);return(isNaN(r)||isNaN(i))&&a===e.value?t.concat(e):r!==i?t:t.concat(e)}(t,a,e):a.type===I.RangeToText&&(t=function(t,e,a){if(void 0===e.from||void 0===e.to||void 0===a)return t;if(null===a&&e.from&&e.to&&"null"===e.from.toLowerCase()&&"null"===e.to.toLowerCase())return t.concat(e);var r=parseFloat(a),i=parseFloat(e.from),o=parseFloat(e.to);return isNaN(r)||isNaN(i)||isNaN(o)?t:r>=i&&r<=o?t.concat(e):t}(t,a,e)),t}),[]);return a.sort((function(t,e){return t.id-e.id})),a},H=function(t,e){return $(t,e)[0]},B=function(t){return!(!t||!t.value)&&"null"===t.value.toLowerCase()};!function(t){t.Absolute="absolute",t.Percentage="percentage"}(V||(V={})),function(t){t.Thresholds="thresholds",t.PaletteClassic="palette-classic",t.PaletteSaturated="palette-saturated",t.ContinuousGrYlRd="continuous-GrYlRd",t.Fixed="fixed"}(j||(j={}));var G,W,Q;function X(t,e){var a,r;try{for(var s=o(t),n=s.next();!n.done;n=s.next()){var l=n.value;switch(l.type){case G.ValueToText:if(null==e)continue;var h=l.options[e];if(h)return h;break;case G.RangeToText:if(null==e)continue;var p=parseFloat(e);if(isNaN(p))continue;if(!isNaN(l.options.from)&&p<l.options.from)continue;if(!isNaN(l.options.to)&&p>l.options.to)continue;return l.options.result;case G.RegexToText:if(null==e)continue;if("string"!=typeof e)continue;var u=Object(_.stringToJsRegex)(l.options.pattern);if(e.match(u)){var c=i({},l.options.result);return null!=c.text&&(c.text=e.replace(u,l.options.result.text||"")),c}case G.SpecialValue:switch(l.options.match){case W.Null:if(null==e)return l.options.result;break;case W.NaN:if(isNaN(e))return l.options.result;break;case W.NullAndNaN:if(isNaN(e)||null==e)return l.options.result;break;case W.True:if(!0===e||"true"===e)return l.options.result;break;case W.False:if(!1===e||"false"===e)return l.options.result;break;case W.Empty:if(""===e)return l.options.result}}}}catch(t){a={error:t}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(a)throw a.error}}return null}!function(t){t.ValueToText="value",t.RangeToText="range",t.RegexToText="regex",t.SpecialValue="special"}(G||(G={})),function(t){t.True="true",t.False="false",t.Null="null",t.NaN="nan",t.NullAndNaN="null+nan",t.Empty="empty"}(W||(W={})),function(t){t[t.ValueToText=1]="ValueToText",t[t.RangeToText=2]="RangeToText"}(Q||(Q={}));var Y=function(t,e){var a=H(t,e);return void 0===a?X(t,e):a},q=a(3),J=function(){function t(t,e,a,r){var i=this;this.onSetThresholds=function(t){},this.$scope=t,this.$sanitize=a,this.templateSrv=e,this.customSplitDelimiter="#️⃣🔠🆗🆗🔠#️⃣",this.activeOverrideIndex=0,this.suggestMetricNames=function(){return h.a.map(i.$scope.ctrl.series,(function(t){return t.alias}))},this.metricOverrides=r;for(var o=0;o<this.metricOverrides.length;o++)void 0===this.metricOverrides[o].label&&(this.metricOverrides[o].label="OVERRIDE "+(o+1))}return t.prototype.addMetricOverride=function(){var t=new R;t.label="OVERRIDE "+(this.metricOverrides.length+1),t.metricName="",t.thresholds=[],t.colors=["#299c46","#e5ac0e","#bf1b00","#4040a0"],t.decimals="",t.enabled=!0,t.unitFormat="short",t.clickThrough="",t.operatorName="avg",t.scaledDecimals=null,t.prefix="",t.suffix="",t.newTabEnabled=!0,t.sanitizeURLEnabled=!0,this.metricOverrides.push(t)},t.prototype.removeMetricOverride=function(t){this.metricOverrides=h.a.without(this.metricOverrides,t);for(var e=0;e<this.metricOverrides.length;e++)this.metricOverrides[e].label.startsWith("OVERRIDE ")&&(this.metricOverrides[e].label="OVERRIDE "+(e+1));this.$scope.ctrl.panel.savedOverrides=this.metricOverrides,this.$scope.ctrl.refresh()},t.prototype.metricNameChanged=function(t){this.$scope.ctrl.refresh()},t.prototype.toggleHide=function(t){t.enabled=!t.enabled,this.$scope.ctrl.refresh()},t.prototype.matchOverride=function(t){for(var e=this.resolveOverrideTemplates(),a=0;a<e.length;a++){var r=e[a],i=Object(_.stringToJsRegex)(r.metricName),o=t.match(i);if(o&&o.length>0&&r.enabled)return e[a]}},t.prototype.resolveOverrideTemplates=function(){var t=this,e=[],a=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g;return this.metricOverrides.forEach((function(r){var o=r.metricName.match(a);o&&o.length>0?o.forEach((function(a){t.templateSrv.replace(a,t.templateSrv.ScopedVars,t.customFormatter).split("#️⃣🔠🆗🆗🔠#️⃣").forEach((function(t){var o=r.metricName.replace(a,t);e.push(i(i({},r),{metricName:o}))}))})):e.push(r)})),e},t.prototype.customFormatter=function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.join("#️⃣🔠🆗🆗🔠#️⃣"):t},t.prototype.applyOverrides=function(t){for(var e=this.$scope.ctrl.panel.polystat,a=0;a<t.length;a++){var r=this.matchOverride(t[a].name);if(r){var i=t[a];i.operatorName=r.operatorName;var o=A(i.operatorName,i),s=z(r.thresholds&&r.thresholds.length?r.thresholds:e.globalThresholds,o,e.polygonGlobalFillColor);t[a].value=o,t[a].color=s.color,t[a].thresholdLevel=s.thresholdLevel;var n=Object(q.convertOldAngularValueMapping)(this.$scope.ctrl.panel),l=Y(n,t[a].value.toString());if(l&&""!==l.text)t[a].valueFormatted=l.text;else{var h=d.a.valueFormats[r.unitFormat];h&&(t[a].valueFormatted=h(t[a].value,r.decimals,r.scaledDecimals),t[a].valueRounded=d.a.roundValue(t[a].value,r.decimals))}if(t[a].prefix=r.prefix,t[a].suffix=r.suffix,r.clickThrough&&r.clickThrough.length>0){var p=this.templateSrv.replace(r.clickThrough,"text");p=U.transformSingleMetric(a,p,t),p=U.transformNthMetric(p,t),p=U.transformByRegex(r.metricName,t[a],p),t[a].clickThrough=p,t[a].newTabEnabled=r.newTabEnabled,t[a].sanitizeURLEnabled=r.sanitizeURLEnabled,r.sanitizeURLEnabled&&(t[a].sanitizedURL=this.$sanitize(t[a].clickThrough))}}else if(e.globalThresholds&&e.globalThresholds.length){s=z(e.globalThresholds,t[a].value,e.polygonGlobalFillColor);t[a].color=s.color,t[a].thresholdLevel=s.thresholdLevel}}},t.prototype.setUnitFormat=function(t,e){t.unitFormat=e.value,this.$scope.ctrl.refresh()},t}(),K=function(){},Z=function(){function t(t,e,a,r){var i=this;this.$scope=t,this.$sanitize=a,this.templateSrv=e,this.customSplitDelimiter="#️⃣🔠🆗🆗🔠#️⃣",this.subTabIndex=0,this.suggestMetricNames=function(){return h.a.map(i.$scope.ctrl.series,(function(t){return t.alias}))},this.metricComposites=r;for(var o=0;o<this.metricComposites.length;o++)void 0===this.metricComposites[o].label&&(this.metricComposites[o].label="COMPOSITE "+(o+1))}return t.prototype.addMetricComposite=function(){var t=new K;t.label="COMPOSITE "+(this.metricComposites.length+1),t.compositeName="",t.displayName="",t.members=[{}],t.enabled=!0,t.clickThrough="",t.hideMembers=!0,t.showName=!0,t.showValue=!0,t.animateMode="all",t.thresholdLevel=0,t.newTabEnabled=!0,t.sanitizeURLEnabled=!0,t.sanitizedURL="",this.metricComposites.push(t)},t.prototype.removeMetricComposite=function(t){this.metricComposites=h.a.without(this.metricComposites,t);for(var e=0;e<this.metricComposites.length;e++)this.metricComposites[e].label="COMPOSITE "+(e+1);this.$scope.ctrl.panel.savedComposites=this.metricComposites,this.$scope.ctrl.refresh()},t.prototype.addMetricToComposite=function(t){void 0===t.members?t.members=[{}]:t.members.push({}),this.$scope.ctrl.refresh()},t.prototype.removeMetricFromComposite=function(t,e){t.members=h.a.without(t.members,e),this.$scope.ctrl.refresh()},t.prototype.resolveCompositeTemplates=function(){var t=this,e=[];return this.metricComposites.forEach((function(a){t.templateSrv.replace(a.compositeName,t.templateSrv.ScopedVars,t.customFormatter).split("#️⃣🔠🆗🆗🔠#️⃣").forEach((function(t){e.push(i(i({},a),{compositeName:t,isTemplated:!0,templatedName:a.compositeName}))}))})),e},t.prototype.customFormatter=function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.join("#️⃣🔠🆗🆗🔠#️⃣"):t},t.prototype.resolveMemberTemplates=function(t,e,a,r,o){var s=this;void 0===o&&(o=this.templateSrv.ScopedVars);var n=[],l=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g;return r.forEach((function(r){if(r.seriesName){var h=r.seriesName.match(l);h&&h.length>0?h.forEach((function(l){e&&l.includes(a)&&(l=l.replace(a,t)),[s.templateSrv.replace(l,o,"raw")].forEach((function(t){var e=r.seriesName.replace(h,t),a=Object(_.escapeStringForRegex)(t),o=r.seriesName.replace(h,a);n.push(i(i({},r),{seriesName:e,seriesNameEscaped:o}))}))})):n.push(r)}})),n},t.prototype.resolveMemberAliasTemplates=function(t,e){var a={};return e.forEach((function(t,e){a[e]={text:e,value:t}})),e.groups&&Object.keys(e.groups).forEach((function(t){a[t.replace(/\s+/g,"_")]={text:t,value:e.groups[t]}})),this.templateSrv.replace(t,a)},t.prototype.applyComposites=function(t){for(var e=[],a=[],r=this.resolveCompositeTemplates(),o=0;o<r.length;o++){var s=[],n=r[o];if(n.enabled){for(var l=null,p=this.resolveMemberTemplates(n.compositeName,n.isTemplated,n.templatedName,n.members,i(i({},this.templateSrv.ScopedVars),{compositeName:{text:"compositeName",value:n.compositeName}})),u=0;u<p.length;u++)for(var c=p[u],d=0;d<t.length;d++)if(void 0!==c.seriesName){var f=c.seriesName;void 0!==c.seriesNameEscaped&&(f=c.seriesNameEscaped);var m=Object(_.stringToJsRegex)(f).exec(t[d].name);if(m&&m.length>0){var v=t[d];if(c.alias&&c.alias.length>0&&(v.displayName=this.resolveMemberAliasTemplates(c.alias,m)),s.push(d),n.hideMembers&&e.push(d),n.clickThrough&&n.clickThrough.length>0){var g=this.templateSrv.replace(n.clickThrough,"text");g=U.transformComposite(n.compositeName,g),g=U.transformSingleMetric(d,g,t),g=U.transformNthMetric(g,t),v.clickThrough=g,v.sanitizedURL=this.$sanitize(g)}}}if(0!==s.length){for(var y=0;y<s.length;y++){v=t[x=s[y]];l=null===l?v:P(l,v)}if(null!==l){var b=l.shallowClone();b.name=n.compositeName;for(d=0;d<s.length;d++){var x=s[d];b.members.push(i(i({},t[x]),{name:t[x].displayName||t[x].name}))}b.thresholdLevel=l.thresholdLevel,b.showName=n.showName,b.showValue=n.showValue,b.animateMode=n.animateMode,b.newTabEnabled=n.newTabEnabled,b.sanitizeURLEnabled=n.sanitizeURLEnabled,b.isComposite=!0,a.push(b)}}}}Array.prototype.push.apply(t,a),e.sort((function(t,e){return e-t}));for(o=t.length;o>=0;o--)h.a.includes(e,o)&&t.splice(o,1);return t},t.prototype.metricNameChanged=function(t){this.$scope.ctrl.refresh()},t.prototype.toggleHide=function(t){t.enabled=!t.enabled,this.$scope.ctrl.refresh()},t}(),tt=function(){function t(){}return t.generate=function(e,a,r){for(var i=[],o=0;o<a.length;o++){var s=e.ctrl.dashboard.formatDate(a[o].timestamp,"YYYY-MM-DD HH:mm:ss"),n="",l="",p="";if("triggered"===r.tooltipDisplayMode)if(0===t.getTriggeredCount(a[o])){r.tooltipTimestampEnabled&&(n='\n              <div class="polystat-panel-tooltip-time">'+s+"</div>\n            ");var u='\n          <div class="polystat-panel-tooltip-displaytext-empty-compositename">'+a[o].name+'</div>\n          <div class="polystat-panel-tooltip-displaytext-empty">'+r.tooltipDisplayTextTriggeredEmpty+"</div>\n          "+n+"\n          ";i.push(u);continue}r.tooltipTimestampEnabled&&(n='\n          <tr>\n            <td colspan="2" style="text-align: center;" class="graph-tooltip-time">'+s+"</td>\n          </tr>\n        ");var c="all"===a[o].displayMode?"":'\n        <tr>\n          <th colspan="2" style="text-align: center;">'+a[o].name+"</th>\n        </tr>\n      ";r.valueEnabled&&(l='\n        <th style="text-align: right;">Value</th>\n        ');var d=['\n        <table width="100%" class="polystat-panel-tooltiptable">\n        <thead>\n          '+c+'\n          <tr>\n            <th style="text-align: left;">Name</th>\n            '+l+"\n          </tr>\n        </thead>\n        <tfoot>\n          "+n+"\n        </tfoot>\n        <tbody>\n      "];if(a[o].members.length>0)for(var f=h.a.orderBy(a[o].members,[e.ctrl.panel.polystat.tooltipPrimarySortField,e.ctrl.panel.polystat.tooltipSecondarySortField],[e.ctrl.panel.polystat.tooltipPrimarySortDirection,e.ctrl.panel.polystat.tooltipSecondarySortDirection]),m=0;m<f.length;m++){var v=f[m];r.valueEnabled&&(p='\n            <td style="text-align: right; padding-left: 8px; color: '+v.color+'">'+v.valueFormatted+"</td>\n            ");var g='\n            <tr>\n              <td style="text-align: left; color: '+v.color+'">'+v.name+"</td>\n              "+p+"\n            </tr>\n          ";switch(r.tooltipDisplayMode){case"triggered":0!==v.thresholdLevel&&d.push(g);break;default:d.push(g)}}else{r.valueEnabled&&(p='\n          <td style="text-align: right; padding-left: 8px; color: '+a[o].color+'">'+a[o].valueFormatted+"</td>\n          ");g='\n        <tr>\n          <td style="text-align: left; color: '+a[o].color+'">'+a[o].name+"</td>\n          "+p+"\n        </tr>\n        ";switch(r.tooltipDisplayMode){case"triggered":0!==a[o].thresholdLevel&&d.push(g);break;default:d.push(g)}}d.push("</tbody></table>"),i.push(d.join("\n"))}return i},t.getTriggeredCount=function(t){var e=0;0!==t.thresholdLevel&&e++;for(var a=0;a<t.members.length;a++)0!==t.members[a].thresholdLevel&&e++;return e},t}(),et=a(8),at=a.n(et),rt=function(){function t(t){this.panel=t}return t.prototype.getSeriesList=function(t){var e=[],a=t.dataList,r=t.range;if(!a||!a.length)return e;for(var i=0;i<a.length;i++){var o=a[i],s=Object(_.getTimeField)(o).timeField;if(s)for(var n=0;n<o.fields.length;n++){var l=o.fields[n];if(l.type===_.FieldType.number){for(var h=Object(_.getFieldDisplayName)(l,o,a),p=[],u=0;u<o.length;u++){var c=l.values.get(u),d=s.values.get(u);void 0!==c&&p.push([c,d])}e.push(this.toTimeSeries(l,h,i,n,p,e.length,r))}}}if("histogram"===this.panel.xaxis.mode&&!this.panel.stack&&e.length>1){var f=e[0];f.alias=f.aliasEscaped="Count";for(i=1;i<e.length;i++)f.datapoints=f.datapoints.concat(e[i].datapoints);return[f]}return e},t.prototype.toTimeSeries=function(t,e,a,r,i,o,s){var n=o%q.colors.length,l=this.panel.aliasColors[e]||q.colors[n],h=l;h=void 0!==at.a.theme.visualization?at.a.theme.visualization.getColorByName(l):Object(_.getColorForTheme)(l,at.a.theme);var p=new m.a({datapoints:i||[],alias:e,color:h,unit:t.config?t.config.unit:void 0,dataFrameIndex:a,fieldIndex:r});if(i&&i.length>0&&s){var u=i[i.length-1][1],c=s.from;if(u-c.valueOf()<-1e4)i[0][1]-c.valueOf()<-1e4&&(p.isOutsideRange=!0)}return p},t}();function it(t){for(var e=0;e<t.fields.length;e++){if(t.fields[e].type===_.FieldType.time)return!0}return!1}function ot(t,e){for(var a=[],r=t.fields.length,i=0;i<r;i++)t.fields[i].type===_.FieldType.string&&a.push(i);return function(t,e,a){for(var r={},i=0;i<e.length;i++){var o=e[i],s=t.fields[o];if(s.type!==_.FieldType.number){var n=nt(s,a);r[s.name]=n}}return r}(t,a,e)}function st(t,e){var a=h.a.cloneDeep(t);return a.labels=e,a}function nt(t,e){return t.values.toArray()[e]}var lt=function(t){function e(e,a,r,i){var o=t.call(this,e,a)||this;return o.$sanitize=i,o.animationModes=[{value:"all",text:"Show All"},{value:"triggered",text:"Show Triggered"}],o.displayModes=[{value:"all",text:"Show All"},{value:"triggered",text:"Show Triggered"}],o.shapes=[{value:"hexagon_pointed_top",text:"Hexagon Pointed Top"},{value:"circle",text:"Circle"},{value:"square",text:"Square"}],o.fontSizes=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70],o.unitFormats=d.a.getUnitFormats(),o.operatorOptions=[{value:"avg",text:"Average"},{value:"count",text:"Count"},{value:"current",text:"Current"},{value:"delta",text:"Delta"},{value:"diff",text:"Difference"},{value:"first",text:"First"},{value:"logmin",text:"Log Min"},{value:"max",text:"Max"},{value:"min",text:"Min"},{value:"name",text:"Name"},{value:"last_time",text:"Time of Last Point"},{value:"time_step",text:"Time Step"},{value:"total",text:"Total"}],o.sortDirections=[{value:"asc",text:"Ascending"},{value:"desc",text:"Descending"}],o.sortFields=[{value:"name",text:"Name"},{value:"thresholdLevel",text:"Threshold Level"},{value:"value",text:"Value"}],o.sortOptions=[{value:0,text:"Disabled"},{value:1,text:"Alphabetical (asc)"},{value:2,text:"Alphabetical (desc)"},{value:3,text:"Numerical (asc)"},{value:4,text:"Numerical (desc)"},{value:5,text:"Alphabetical (case-insensitive, asc)"},{value:6,text:"Alphabetical (case-insensitive, desc)"}],o.mappingTypes=[{text:"value to text",value:1},{text:"range to text",value:2}],o.panelDefaults={nullPointMode:"connected",savedComposites:[],savedOverrides:[],colors:["#299c46","#ED8128","#d44a3a","#4040a0"],valueMaps:[{value:"null",op:"=",text:"N/A"}],rangeMaps:[{from:"null",to:"null",text:"N/A"}],mappingType:1,polystat:{animationSpeed:2500,columns:"",columnAutoSize:!0,displayLimit:100,defaultClickThrough:"",defaultClickThroughNewTab:!1,defaultClickThroughSanitize:!1,ellipseEnabled:!1,ellipseCharacters:18,fontAutoScale:!0,fontSize:12,fontType:"Roboto",fontAutoColor:!0,globalUnitFormat:"short",globalDecimals:2,globalDisplayMode:"all",globalOperatorName:"avg",globalDisplayTextTriggeredEmpty:"OK",gradientEnabled:!0,hexagonSortByDirection:"asc",hexagonSortByField:"name",maxMetrics:0,polygonBorderSize:2,polygonBorderColor:"#000000",polygonGlobalFillColor:"#0a55a1",radius:"",radiusAutoSize:!0,rows:"",rowAutoSize:!0,shape:"hexagon_pointed_top",tooltipDisplayMode:"all",tooltipDisplayTextTriggeredEmpty:"OK",tooltipFontSize:12,tooltipFontType:"Roboto",tooltipPrimarySortDirection:"desc",tooltipPrimarySortField:"thresholdLevel",tooltipSecondarySortDirection:"desc",tooltipSecondarySortField:"value",tooltipTimestampEnabled:!0,tooltipEnabled:!0,valueEnabled:!0,regexPattern:""}},h.a.defaultsDeep(o.panel,o.panelDefaults),o.useDataFrames=!0,o.processor=new rt({xaxis:{mode:"custom"},aliasColors:{}}),o.d3DivId="d3_svg_"+o.panel.id,o.containerDivId="container_"+o.d3DivId,o.initialized=!1,o.panelContainer=null,o.templateSrv=r,o.svgContainer=null,o.panelWidth=null,o.panelHeight=null,o.polystatData=[],o.d3Object=null,o.series=[],o.tooltipContent=[],o.migrateSortDirections(),o.overridesCtrl=new J(e,r,i,o.panel.savedOverrides),o.compositesManager=new Z(e,r,i,o.panel.savedComposites),o.events.on(_.PanelEvents.dataFramesReceived,o.onDataFramesReceived.bind(o)),o.events.on(_.PanelEvents.dataError,o.onDataError.bind(o)),o.events.on(_.PanelEvents.dataSnapshotLoad,o.onSnapshotLoad.bind(o)),o.events.on(_.PanelEvents.editModeInitialized,o.onInitEditMode.bind(o)),o}return e.$inject=["$scope","$injector","templateSrv","$sanitize"],function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}(e,t),e.prototype.migrateSortDirections=function(){"asc"===this.panel.polystat.hexagonSortByDirection&&(this.panel.polystat.hexagonSortByDirection=1),"desc"===this.panel.polystat.hexagonSortByDirection&&(this.panel.polystat.hexagonSortByDirection=2),"asc"===this.panel.polystat.tooltipPrimarySortDirection&&(this.panel.polystat.tooltipPrimarySortDirection=1),"desc"===this.panel.polystat.tooltipPrimarySortDirection&&(this.panel.polystat.tooltipPrimarySortDirection=2),"asc"===this.panel.polystat.tooltipSecondarySortDirection&&(this.panel.polystat.tooltipSecondarySortDirection=1),"desc"===this.panel.polystat.tooltipSecondarySortDirection&&(this.panel.polystat.tooltipSecondarySortDirection=2)},e.prototype.onInitEditMode=function(){var t="public/plugins/"+this.panel.type+"/",e=t+"partials/editor.options.html";this.addEditorTab("Options",e,2);var a=t+"partials/editor.overrides.html";this.addEditorTab("Overrides",a,3);var r=t+"partials/editor.composites.html";this.addEditorTab("Composites",r,4);var i=t+"partials/editor.mappings.html";this.addEditorTab("Value Mappings",i,5)},e.prototype.setContainer=function(t){this.panelContainer=t,this.svgContainer=t},e.prototype.getPanelWidthFailsafe=function(){var t=0;if(void 0!==this.panel.gridPos){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0)/24;return t=Math.round(this.panel.gridPos.w*e)}if(void 0===this.panel.span)t=this.editModeInitiated?Math.max(document.documentElement.clientWidth,window.innerWidth):this.panelContainer.offsetParent.clientWidth;else{var a=Math.max(document.documentElement.clientWidth,window.innerWidth||0)/12;t=Math.round(this.panel.span*a)}return t},e.prototype.getPanelHeight=function(){var t=this.panel.height;if(void 0===t||""===t){if(t=String(this.height),void 0!==this.panel.span){var e=20;""!==this.panel.title&&(e=42),t=String(this.containerHeight-e)}void 0===t&&void 0===(t=this.row.height)&&(t="250")}return t=t.replace("px",""),parseInt(t,10)},e.prototype.clearSVG=function(){u()("#"+this.d3DivId).length&&u()("#"+this.d3DivId).remove(),u()("#"+this.d3DivId+"-panel").length&&u()("#"+this.d3DivId+"-panel").remove(),u()("#"+this.d3DivId+"-tooltip").length&&u()("#"+this.d3DivId+"-tooltip").remove()},e.prototype.applyRegexPattern=function(){for(var t=this.series,e=function(e){if(""!==a.panel.polystat.regexPattern&&void 0!==a.panel.polystat.regexPattern){var r=Object(_.stringToJsRegex)(a.panel.polystat.regexPattern);if(t[e].id&&r.test(t[e].id.toString())){var i=r.exec(t[e].id.toString());if(!i)return"continue";var o="";i.length>1&&(i.slice(1).forEach((function(t,e){t&&(o+=o.length>0?" "+t.toString():t.toString())})),t[e].alias=o,t[e].label=o)}}else t[e].alias=t[e].id,t[e].label=t[e].id},a=this,r=0;r<t.length;r++)e(r);this.series=t},e.prototype.renderD3=function(){this.clearSVG(),0===this.panelWidth&&(this.panelWidth=this.getPanelWidthFailsafe()),this.panelHeight=this.getPanelHeight();var t={top:0,right:0,bottom:0,left:0},e=this.panelWidth,a=this.panelHeight;t.top=0,void 0!==this.panel.span&&""!==this.panel.title&&(t.top=7),t.bottom=0;var r=this.panel.polystat;if(void 0===r.polygonBorderSize&&(r.polygonBorderSize=0),void 0===r.polygonBorderColor&&(r.polygonBorderColor="#000000"),0===this.polystatData.length)return this.d3Object=null,void(this.svgContainer.innerHTML='<div\n          style="text-align: center;\n          vertical-align: middle;\n          font-size: x-large;\n          line-height: '+a+'px;"\n          id="'+this.d3DivId+'">\n        NO DATA\n        </div>');var i=h.a.cloneDeep(this.polystatData),o={width:e,height:a,radius:r.radius,radiusAutoSize:r.radiusAutoSize,tooltipFontSize:r.tooltipFontSize,tooltipFontType:r.tooltipFontType,data:i,displayLimit:r.displayLimit,globalDisplayMode:r.globalDisplayMode,columns:r.columns,columnAutoSize:r.columnAutoSize,rows:r.rows,rowAutoSize:r.rowAutoSize,tooltipContent:this.tooltipContent,animationSpeed:r.animationSpeed,defaultClickThrough:this.getDefaultClickThrough(NaN),polystat:r};this.d3Object=null,this.d3Object=new E(this.templateSrv,this.svgContainer,this.d3DivId,o),this.d3Object.draw()},e.prototype.removeValueMap=function(t){var e=h.a.indexOf(this.panel.valueMaps,t);this.panel.valueMaps.splice(e,1),this.render()},e.prototype.applyRegex=function(){this.applyRegexPattern(),this.render()},e.prototype.addValueMap=function(){this.panel.valueMaps.push({value:"",op:"=",text:""})},e.prototype.removeRangeMap=function(t){var e=h.a.indexOf(this.panel.rangeMaps,t);this.panel.rangeMaps.splice(e,1),this.render()},e.prototype.addRangeMap=function(){this.panel.rangeMaps.push({from:"",to:"",text:""})},e.prototype.onThresholdsChanged=function(t){this.panel.refresh()},e.prototype.link=function(t,e,a,r){if(t&&a){var i=e.find(".grafana-d3-polystat");i.append('<div style="width: 100%; height: 100%;" id="'+r.containerDivId+'"></div>');var o=i[0].childNodes[0];r.setContainer(o),e=e.find(".grafana-d3-polystat");this.events.on(_.PanelEvents.render,(function(){r.panelWidth=e.width(),r.panelWidth=e.width(),r.renderD3(),r.renderingCompleted()}))}},e.prototype.setValues=function(){var t=this.panel.polystat;if(this.polystatData.length=0,this.applyRegexPattern(),this.series&&this.series.length>0)for(var e=0;e<this.series.length;e++){var a=this.series[e];if(a.datapoints.length>0){var r=L.TimeSeriesToPolystat(t.globalOperatorName,a);this.polystatData.push(r)}}this.applyGlobalFormatting(this.polystatData),this.polystatData=h.a.orderBy(this.polystatData,[t.hexagonSortByField],[this.panel.polystat.hexagonSortByDirection]),0!==this.overridesCtrl.metricOverrides.length&&this.overridesCtrl.metricOverrides.length===this.panel.savedOverrides||(this.overridesCtrl.metricOverrides=this.panel.savedOverrides),this.overridesCtrl.applyOverrides(this.polystatData),0!==this.compositesManager.metricComposites.length&&this.compositesManager.metricComposites.length===this.panel.savedComposites||(this.compositesManager.metricComposites=this.panel.savedComposites),this.polystatData=this.compositesManager.applyComposites(this.polystatData);for(e=0;e<this.polystatData.length;e++)0===this.polystatData[e].clickThrough.length&&(this.polystatData[e].clickThrough=this.getDefaultClickThrough(e),this.polystatData[e].newTabEnabled=t.defaultClickThroughNewTab,this.polystatData[e].sanitizeURLEnabled=t.defaultClickThroughSanitize,this.polystatData[e].sanitizedURL=this.$sanitize(this.polystatData[e].clickThrough));this.polystatData=this.filterByGlobalDisplayMode(this.polystatData),this.polystatData=C(this.polystatData,this.panel.polystat.hexagonSortByField,this.panel.polystat.hexagonSortByDirection),this.tooltipContent=tt.generate(this.$scope,this.polystatData,t)},e.prototype.applyGlobalFormatting=function(t){for(var e=Object(q.convertOldAngularValueMapping)(this.panel),a=0;a<t.length;a++)if(null!==t[a].value){var r=Y(e,t[a].value.toString());if(r&&""!==r.text)t[a].valueFormatted=r.text;else{var i=d.a.valueFormats[this.panel.polystat.globalUnitFormat];if(i){var o=T(t[a].value,this.panel.polystat.globalDecimals);t[a].valueFormatted=i(t[a].value,o.decimals,o.scaledDecimals),t[a].valueRounded=d.a.roundValue(t[a].value,o.decimals)}}t[a].color=this.panel.polystat.polygonGlobalFillColor}},e.prototype.filterByGlobalDisplayMode=function(t){var e=[],a=[];if("all"!==this.panel.polystat.globalDisplayMode){for(var r=t.length,i=0;i<r;i++){var o=t[i];o.isComposite&&a.push(o),o.thresholdLevel<1&&e.push(i)}for(i=t.length;i>=0;i--)h.a.includes(e,i)&&t.splice(i,1);0===t.length&&a.length>0&&(t=a)}return t},e.prototype.onDataError=function(t){this.onDataFramesReceived([]),this.render()},e.prototype.onSnapshotLoad=function(t){this.onDataFramesReceived(function(t){var e,a,r,i;if(!t||!Object(l.map)(t))return[];var s=[];try{for(var n=o(t),h=n.next();!h.done;h=n.next()){var p=h.value,u=Object(_.guessFieldTypes)(Object(_.toDataFrame)(p));if(u.fields&&u.fields.length)try{for(var c=(r=void 0,o(u.fields)),d=c.next();!d.done;d=c.next()){d.value.state=null}}catch(t){r={error:t}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}s.push(u)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(a=n.return)&&a.call(n)}finally{if(e)throw e.error}}return s}(t))},e.prototype.seriesToPolystat=function(t,e){return L.TimeSeriesToPolystat(t,e)},e.prototype.tableToPolystat=function(t,e){return null},e.prototype.onDataFramesReceived=function(t){var e,a,r=this;if(t=function(t){for(var e=Date.now(),a=[],r=0;r<t.length;r++){var i=t[r],o=h.a.cloneDeep(i);o.fields=[];for(var s=it(i),n=i.fields.length,l=0;l<n;l++){if((v=i.fields[l]).type===_.FieldType.number){var p=v.values.toArray().length;if(s){var u=Object.assign({},v);o.fields.push(u)}else for(var c=0;c<p;c++)if(null!==v.values.toArray()[c]){var d=st(v,ot(i,c)),f=new _.ArrayVector,m=nt(v,c);f.add(m),d.values=f,o.fields.push(d)}}}if(s)for(l=0;l<i.fields.length;l++){var v;(v=i.fields[l]).type!==_.FieldType.number&&o.fields.push(v)}else{var g=new _.ArrayVector;g.add(e);var y={name:"Time",type:_.FieldType.time,values:g,config:null};o.fields.push(y)}a.push(o)}return a}(t),this.series=this.processor.getSeriesList({dataList:t,range:this.range}).map((function(t){return t.color=void 0,t.flotpairs=t.getFlotPairs(r.panel.nullPointMode),t})),this.dataWarning=null,0===h.a.reduce(this.series,(function(t,e){return t+e.datapoints.length}),0))this.dataWarning={title:"No data points",tip:"No datapoints returned from data query"};else try{for(var i=o(this.series),s=i.next();!s.done;s=i.next()){if(s.value.isOutsideRange){this.dataWarning={title:"Data points outside time range",tip:"Can be caused by timezone mismatch or missing time filter in query"};break}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(e)throw e.error}}this.setValues(),this.render()},e.prototype.seriesHandler=function(t){var e=new m.a({datapoints:t.datapoints,alias:t.target});return e.flotpairs=e.getFlotPairs(this.panel.nullPointMode),e},e.prototype.invertColorOrder=function(){var t=this.panel.colors[0];this.panel.colors[0]=this.panel.colors[2],this.panel.colors[2]=t,this.render()},e.prototype.validateAnimationSpeed=function(){var t=this.panel.polystat.animationSpeed,e=5e3;if(t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);e=a>=500?a:500}this.panel.polystat.animationSpeed=e,this.render()},e.prototype.validateDisplayLimit=function(){var t=this.panel.polystat.displayLimit,e=100;if(null===t)e=0;else if(!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>=0&&(e=a)}this.panel.polystat.displayLimit=0===e?"":e,this.render()},e.prototype.validateColumnValue=function(){if(this.panel.polystat.columnAutoSize)this.panel.polystat.columns="";else{var t=this.panel.polystat.columns,e=1;if(t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>0&&(e=a)}this.panel.polystat.columns=e}this.render()},e.prototype.validateRowValue=function(){if(this.panel.polystat.rowAutoSize)this.panel.polystat.rows="";else{var t=this.panel.polystat.rows,e=1;if(t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>0&&(e=a)}this.panel.polystat.rows=e}this.render()},e.prototype.validateRadiusValue=function(){if(this.panel.polystat.radiusAutoSize)this.panel.polystat.radius="";else{var t=this.panel.polystat.radius,e=25;if(null!==t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>0&&(e=a)}this.panel.polystat.radius=e}this.render()},e.prototype.validateFontColorValue=function(){this.panel.polystat.fontAutoColor?this.panel.polystat.fontColor="":this.panel.polystat.fontColor||(this.panel.polystat.fontColor="black"),this.render()},e.prototype.validateBorderSizeValue=function(){var t=this.panel.polystat.polygonBorderSize,e=2;if(null!==t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>=0&&(e=a)}this.panel.polystat.polygonBorderSize=e,this.render()},e.prototype.getDefaultClickThrough=function(t){var e=this.panel.polystat.defaultClickThrough;return e=U.transformSingleMetric(t,e,this.polystatData),e=U.transformNthMetric(e,this.polystatData),e=this.templateSrv.replace(e,"text")},e.prototype.setGlobalUnitFormat=function(t){this.panel.polystat.globalUnitFormat=t.value,this.panel.refresh()},e.templateUrl="partials/template.html",e}(n.MetricsPanelCtrl),ht=a(9),pt=a.n(ht),ut=function(){function t(t){this.$scope=t,this.thresholdStates=[{value:0,text:"ok"},{value:1,text:"warning"},{value:2,text:"critical"},{value:3,text:"custom"}],this.thresholds=[],t.thresholds&&(this.thresholds=function(t,e,a){if(a||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}([],s(t.thresholds),!1))}return t.$inject=["$scope"],t.prototype.sortThresholds=function(){this.thresholds=h.a.orderBy(this.thresholds,["value"],["asc"])},t.prototype.doRefresh=function(){this.thresholds&&this.thresholds.length?this.$scope.thresholds=this.thresholds:this.$scope.thresholds=void 0,this.$scope.callback()},t.prototype.addThreshold=function(){this.thresholds.push({value:0,state:0,color:"#299c46"}),this.sortThresholds(),this.doRefresh()},t.prototype.setThresholdColor=function(t){t.color=function(t){if(!t.startsWith("rgb"))return t;var e="#FFFFFF";try{e="#"+t.split("(")[1].split(")")[0].split(",").map((function(t){return 1===(t=parseInt(t,10).toString(16)).length?"0"+t:t})).join("")}catch(t){return e}return e}(t.color),this.doRefresh()},t.prototype.updateThresholdColor=function(t){var e=this.$scope.colors;t.color=e[t.state],this.doRefresh()},t.prototype.removeThreshold=function(t){this.thresholds=h.a.without(this.thresholds,t),this.sortThresholds(),this.doRefresh()},t}();pt.a.directive("polyThresholds",(function(){return{controller:ut,controllerAs:"ctrl",restrict:"E",scope:{thresholds:"=",colors:"=",override:"=?",callback:"&"},templateUrl:"./public/plugins/grafana-polystat-panel/partials/thresholds.html"}})),a.d(e,"PanelCtrl",(function(){return lt})),Object(n.loadPluginCss)({dark:"plugins/grafana-polystat-panel/styles/dark.css",light:"plugins/grafana-polystat-panel/styles/light.css"})}])}));
//# sourceMappingURL=module.js.map